

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>utool.util_cplat &mdash; utool 1.1.2.dev1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="utool 1.1.2.dev1 documentation" href="../../index.html"/>
        <link rel="up" title="utool" href="../utool.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> utool
          

          
          </a>

          
            
            
              <div class="version">
                1.1.2.dev1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../utool.html">utool package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">utool</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../utool.html">utool</a> &raquo;</li>
      
    <li>utool.util_cplat</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for utool.util_cplat</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">cross platform utilities</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span><span class="p">,</span> <span class="n">normpath</span><span class="p">,</span> <span class="n">basename</span>
<span class="kn">from</span> <span class="nn">.util_inject</span> <span class="kn">import</span> <span class="n">inject</span>
<span class="kn">from</span> <span class="nn">utool._internal</span> <span class="kn">import</span> <span class="n">meta_util_cplat</span>
<span class="kn">from</span> <span class="nn">utool._internal.meta_util_path</span> <span class="kn">import</span> <span class="n">unixpath</span><span class="p">,</span> <span class="n">truepath</span>
<span class="k">print</span><span class="p">,</span> <span class="n">print_</span><span class="p">,</span> <span class="n">printDBG</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">inject</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;[cplat]&#39;</span><span class="p">)</span>

<span class="n">COMPUTER_NAME</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">node</span><span class="p">()</span>

<span class="n">OS_TYPE</span> <span class="o">=</span> <span class="n">meta_util_cplat</span><span class="o">.</span><span class="n">OS_TYPE</span>
<span class="n">WIN32</span>  <span class="o">=</span> <span class="n">meta_util_cplat</span><span class="o">.</span><span class="n">WIN32</span>
<span class="n">LINUX</span>  <span class="o">=</span> <span class="n">meta_util_cplat</span><span class="o">.</span><span class="n">LINUX</span>
<span class="n">DARWIN</span> <span class="o">=</span> <span class="n">meta_util_cplat</span><span class="o">.</span><span class="n">DARWIN</span>

<span class="n">LIB_EXT_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;.so&#39;</span><span class="p">,</span> <span class="s">&#39;.dll&#39;</span><span class="p">,</span> <span class="s">&#39;.dylib&#39;</span><span class="p">,</span> <span class="s">&#39;.pyd&#39;</span><span class="p">]</span>

<span class="n">LIB_DICT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;win32&#39;</span><span class="p">:</span> <span class="s">&#39;.dll&#39;</span><span class="p">,</span>
    <span class="s">&#39;linux&#39;</span><span class="p">:</span> <span class="s">&#39;.so&#39;</span><span class="p">,</span>
    <span class="s">&#39;darwin&#39;</span><span class="p">:</span> <span class="s">&#39;.dylib&#39;</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">PYLIB_DICT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;win32&#39;</span><span class="p">:</span> <span class="s">&#39;.pyd&#39;</span><span class="p">,</span>
    <span class="s">&#39;linux&#39;</span><span class="p">:</span> <span class="s">&#39;.so&#39;</span><span class="p">,</span>
    <span class="s">&#39;darwin&#39;</span><span class="p">:</span> <span class="s">&#39;.dylib&#39;</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="in_pyinstaller_package"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.in_pyinstaller_package">[docs]</a><span class="k">def</span> <span class="nf">in_pyinstaller_package</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/22472124/what-is-sys-meipass-in-python</span>
<span class="sd">        http://stackoverflow.com/questions/7674790/bundling-data-files-with-pyinstaller-onefile</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">&#39;_MEIPASS&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_free_diskbytes"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_free_diskbytes">[docs]</a><span class="k">def</span> <span class="nf">get_free_diskbytes</span><span class="p">(</span><span class="n">dir_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        folder/drive free space (in bytes)</span>

<span class="sd">    References::</span>
<span class="sd">        http://stackoverflow.com/questions/51658/cross-platform-space-remaining-on-volume-using-python</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ctypes</span>
        <span class="n">free_bytes</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ulonglong</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">outvar</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">free_bytes</span><span class="p">)</span>
        <span class="n">dir_ptr</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar_p</span><span class="p">(</span><span class="n">dir_</span><span class="p">)</span>
        <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="o">.</span><span class="n">GetDiskFreeSpaceExW</span><span class="p">(</span><span class="n">dir_ptr</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">outvar</span><span class="p">)</span>
        <span class="n">bytes_</span> <span class="o">=</span> <span class="n">free_bytes</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">bytes_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">statvfs</span><span class="p">(</span><span class="n">dir_</span><span class="p">)</span>
        <span class="n">bytes_</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">f_bavail</span> <span class="o">*</span> <span class="n">st</span><span class="o">.</span><span class="n">f_frsize</span>
        <span class="k">return</span> <span class="n">bytes_</span>

</div>
<div class="viewcode-block" id="chmod_add_executable"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.chmod_add_executable">[docs]</a><span class="k">def</span> <span class="nf">chmod_add_executable</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/15607903/python-module-os-chmodfile-664-does-not-change-the-permission-to-rw-rw-r-bu</span>
<span class="sd">        http://www.tutorialspoint.com/python/os_chmod.htm</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">stat</span>
    <span class="n">orig_mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span>
    <span class="n">new_mode</span> <span class="o">=</span> <span class="n">orig_mode</span>
    <span class="k">if</span> <span class="n">group</span><span class="p">:</span>
        <span class="n">new_mode</span> <span class="o">|=</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IXGRP</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="n">new_mode</span> <span class="o">|=</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IXGRP</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IEXEC</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">new_mode</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="is_file_writable"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.is_file_writable">[docs]</a><span class="k">def</span> <span class="nf">is_file_writable</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="is_file_executable"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.is_file_executable">[docs]</a><span class="k">def</span> <span class="nf">is_file_executable</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_file_info"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_file_info">[docs]</a><span class="k">def</span> <span class="nf">get_file_info</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_time</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
    <span class="n">statbuf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;filesize&#39;</span><span class="p">,</span> <span class="n">get_file_nBytes_str</span><span class="p">(</span><span class="n">fpath</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">&#39;last_modified&#39;</span><span class="p">,</span> <span class="n">util_time</span><span class="o">.</span><span class="n">unixtime_to_datetimestr</span><span class="p">(</span><span class="n">statbuf</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">,</span> <span class="n">isutc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">tzname</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&#39;last_accessed&#39;</span><span class="p">,</span> <span class="n">util_time</span><span class="o">.</span><span class="n">unixtime_to_datetimestr</span><span class="p">(</span><span class="n">statbuf</span><span class="o">.</span><span class="n">st_atime</span><span class="p">,</span> <span class="n">isutc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">tzname</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&#39;created&#39;</span><span class="p">,</span> <span class="n">util_time</span><span class="o">.</span><span class="n">unixtime_to_datetimestr</span><span class="p">(</span><span class="n">statbuf</span><span class="o">.</span><span class="n">st_ctime</span><span class="p">,</span> <span class="n">isutc</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">tzname</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">info</span>
    <span class="c">#print &quot;Modification time:&quot;,statbuf.st_mtime</span>

</div>
<div class="viewcode-block" id="get_file_nBytes"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_file_nBytes">[docs]</a><span class="k">def</span> <span class="nf">get_file_nBytes</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_file_nBytes_str"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_file_nBytes_str">[docs]</a><span class="k">def</span> <span class="nf">get_file_nBytes_str</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_str</span>
    <span class="k">return</span> <span class="n">util_str</span><span class="o">.</span><span class="n">byte_str2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">fpath</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="get_disk_space"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_disk_space">[docs]</a><span class="k">def</span> <span class="nf">get_disk_space</span><span class="p">(</span><span class="n">start_path</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/1392413/calculating-a-directory-size-using-python</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dname_list</span><span class="p">,</span> <span class="n">fname_list</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">start_path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fname_list</span><span class="p">:</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">total_size</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">return</span> <span class="n">total_size</span>

</div>
<div class="viewcode-block" id="get_dir_diskspaces"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_dir_diskspaces">[docs]</a><span class="k">def</span> <span class="nf">get_dir_diskspaces</span><span class="p">(</span><span class="n">dir_</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_path</span>
    <span class="n">path_list</span> <span class="o">=</span> <span class="n">util_path</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">dir_</span><span class="p">)</span>
    <span class="n">nBytes_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_disk_space</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">]</span>
    <span class="n">spacetup_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nBytes_list</span><span class="p">,</span> <span class="n">path_list</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">spacetup_list</span>

</div>
<div class="viewcode-block" id="print_dir_diskspace"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.print_dir_diskspace">[docs]</a><span class="k">def</span> <span class="nf">print_dir_diskspace</span><span class="p">(</span><span class="n">dir_</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span>
    <span class="n">spacetup_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">get_dir_diskspaces</span><span class="p">(</span><span class="n">dir_</span><span class="p">))</span>
    <span class="n">nBytes_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">spacetup_list</span><span class="p">]</span>
    <span class="n">path_list</span>   <span class="o">=</span> <span class="p">[</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">spacetup_list</span><span class="p">]</span>
    <span class="n">space_list</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">utool</span><span class="o">.</span><span class="n">byte_str2</span><span class="p">,</span> <span class="n">nBytes_list</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">space_list</span><span class="p">))</span>
    <span class="n">fmtstr</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;%&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">space_list2</span> <span class="o">=</span> <span class="p">[</span><span class="n">fmtstr</span> <span class="o">%</span> <span class="n">space</span> <span class="k">for</span> <span class="n">space</span> <span class="ow">in</span> <span class="n">space_list</span><span class="p">]</span>
    <span class="n">tupstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">space2</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">space2</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">space_list2</span><span class="p">,</span> <span class="n">path_list</span><span class="p">)]</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tupstr_list</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="get_lib_ext"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_lib_ext">[docs]</a><span class="k">def</span> <span class="nf">get_lib_ext</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">LIB_DICT</span><span class="p">[</span><span class="n">OS_TYPE</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="get_pylib_ext"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_pylib_ext">[docs]</a><span class="k">def</span> <span class="nf">get_pylib_ext</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">PYLIB_DICT</span><span class="p">[</span><span class="n">OS_TYPE</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="python_executable"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.python_executable">[docs]</a><span class="k">def</span> <span class="nf">python_executable</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">unixpath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ls_libs"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.ls_libs">[docs]</a><span class="k">def</span> <span class="nf">ls_libs</span><span class="p">(</span><span class="n">dpath</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_list</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_path</span>
    <span class="n">lib_patterns</span> <span class="o">=</span> <span class="n">get_dynamic_lib_globstrs</span><span class="p">()</span>
    <span class="n">libpaths_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">util_path</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">pat</span><span class="p">)</span> <span class="k">for</span> <span class="n">pat</span> <span class="ow">in</span> <span class="n">lib_patterns</span><span class="p">]</span>
    <span class="n">libpath_list</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">libpaths_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">libpath_list</span>

</div>
<div class="viewcode-block" id="get_dynlib_dependencies"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_dynlib_dependencies">[docs]</a><span class="k">def</span> <span class="nf">get_dynlib_dependencies</span><span class="p">(</span><span class="n">lib_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes tools for inspecting dynamic library dependencies depending on the</span>
<span class="sd">    current platform.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">LINUX</span><span class="p">:</span>
        <span class="n">ldd_fpath</span> <span class="o">=</span> <span class="s">&#39;/usr/bin/ldd&#39;</span>
        <span class="n">depend_out</span><span class="p">,</span> <span class="n">depend_err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">(</span><span class="n">ldd_fpath</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">DARWIN</span><span class="p">:</span>
        <span class="n">otool_fpath</span> <span class="o">=</span> <span class="s">&#39;/opt/local/bin/otool&#39;</span>
        <span class="n">depend_out</span><span class="p">,</span> <span class="n">depend_err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">(</span><span class="n">otool_fpath</span><span class="p">,</span> <span class="s">&#39;-L&#39;</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="n">depend_out</span><span class="p">,</span> <span class="n">depend_err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">(</span><span class="s">&#39;objdump&#39;</span><span class="p">,</span> <span class="s">&#39;-p&#39;</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#fnmatch.filter(depend_out.split(&#39;\n&#39;), &#39;*DLL*&#39;)</span>
        <span class="n">relevant_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">depend_out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="s">&#39;DLL Name:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
        <span class="n">depend_out</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relevant_lines</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;bad dependency check&#39;</span>
    <span class="k">return</span> <span class="n">depend_out</span>
    <span class="c"># objdump -p C:\Python27\Lib\site-packages\PIL\_imaging.pyd | grep dll</span>
    <span class="c"># dumpbin /dependents C:\Python27\Lib\site-packages\PIL\_imaging.pyd</span>
    <span class="c"># depends /c /a:1 /f:1 C:\Python27\Lib\site-packages\PIL\_imaging.pyd</span>

</div>
<div class="viewcode-block" id="get_dynlib_exports"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_dynlib_exports">[docs]</a><span class="k">def</span> <span class="nf">get_dynlib_exports</span><span class="p">(</span><span class="n">lib_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes tools for inspecting dynamic library dependencies depending on the</span>
<span class="sd">    current platform. Returns the names of callable functions.</span>

<span class="sd">    Args:</span>
<span class="sd">        lib_path (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: depend_out</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_cplat --test-get_dynlib_exports</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_cplat import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; lib_path = &#39;/home/joncrall/venv/local/lib/python2.7/site-packages/pyflann/lib/libflann.so&#39;</span>
<span class="sd">        &gt;&gt;&gt; depend_out = get_dynlib_exports(lib_path)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;depend_out = %s&#39; % (str(depend_out),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">LINUX</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        nm_fpath = &#39;/usr/bin/nm&#39;</span>
<span class="sd">        exportssout, err, ret = cmd(nm_fpath, &#39;-D&#39;, lib_path, &#39;|&#39;, &#39;c++filt&#39;, verbose=False)</span>
<span class="sd">        lines = exportssout.split(&#39;\n&#39;)</span>
<span class="sd">        #lines = [line[19:] for line in line]</span>
<span class="sd">        others = []</span>
<span class="sd">        info = []</span>
<span class="sd">        for line in lines:</span>
<span class="sd">            if line == &#39;&#39;:</span>
<span class="sd">                continue</span>
<span class="sd">            line = ut.remove_doublspaces(line)</span>
<span class="sd">            words = line.split(&#39; &#39;)</span>
<span class="sd">            if len(words) &gt; 2:</span>
<span class="sd">                # address, type_, rest</span>
<span class="sd">                rest = &#39; &#39;.join(words[2:])</span>
<span class="sd">                info.append((rest, words[0], words[1]))</span>
<span class="sd">            else:</span>
<span class="sd">                others.append(line)</span>

<span class="sd">        # remove duplicate address spaces</span>
<span class="sd">        info = ut.unique_keep_order(info)</span>
<span class="sd">        # remove stdlib</span>
<span class="sd">        info = [line for line in info if &#39;std::&#39; not in line[0]]</span>
<span class="sd">        info = [line for line in info if not line[0].startswith(&#39;typeinfo&#39;)]</span>
<span class="sd">        info = [line for line in info if not line[0].startswith(&#39;vtable&#39;)]</span>
<span class="sd">        info = [line for line in info if &#39;flann&#39; in line[0]]</span>
<span class="sd">        info = [line for line in info if &#39;flann_&#39; in line[0]]</span>

<span class="sd">        info2 = []</span>
<span class="sd">        for rest, loc, type_ in info:</span>
<span class="sd">            parts = rest.split(&#39; &#39;)</span>
<span class="sd">            rettype = parts[0]</span>
<span class="sd">            rest2 = &#39; &#39;.join(parts[1:])</span>
<span class="sd">            if not rest2.startswith(&#39;__&#39;):</span>
<span class="sd">                info2.append((rettype, rest2, type_))</span>
<span class="sd">                #info2.append((rettype, rest2, type_, loc))</span>

<span class="sd">        len([line for line in info if &#39;flann&#39; in line[0]])</span>

<span class="sd">        len([(line.split(&#39; &#39;)[0], line.split(&#39; &#39;)[1], &#39; &#39;.join(line.split(&#39; &#39;)[2:])) for line in lines])</span>
<span class="sd">        len([line for line in lines if line.startswith(&#39;flann::&#39;)])</span>
<span class="sd">        len([line for line in lines if &#39;flann_&#39; in line])</span>
<span class="sd">        len([line for line in lines if not line.endswith(&#39;)&#39;) and &#39;flann_&#39; in line])</span>
<span class="sd">        # HACK: FIND A CORRECT PARSING</span>
<span class="sd">        return info2</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">DARWIN</span><span class="p">:</span>
        <span class="n">otool_fpath</span> <span class="o">=</span> <span class="s">&#39;/opt/local/bin/otool&#39;</span>
        <span class="n">exportssout</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">(</span><span class="n">otool_fpath</span><span class="p">,</span> <span class="s">&#39;-L&#39;</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#TODO</span>
    <span class="k">elif</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="n">exportssout</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">(</span><span class="s">&#39;objdump&#39;</span><span class="p">,</span> <span class="s">&#39;-p&#39;</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#TODO</span>
        <span class="c">#fnmatch.filter(depend_out.split(&#39;\n&#39;), &#39;*DLL*&#39;)</span>
        <span class="c">#relevant_lines = [line for line in depend_out.splitlines() if &#39;DLL Name:&#39; in line]</span>
        <span class="c">#depend_out = &#39;\n&#39;.join(relevant_lines)</span>
    <span class="k">assert</span> <span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;bad dependency check&#39;</span>
    <span class="k">return</span> <span class="n">exportssout</span>

</div>
<div class="viewcode-block" id="get_dynamic_lib_globstrs"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_dynamic_lib_globstrs">[docs]</a><span class="k">def</span> <span class="nf">get_dynamic_lib_globstrs</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="s">&#39;*&#39;</span> <span class="o">+</span> <span class="n">libext</span> <span class="k">for</span> <span class="n">libext</span> <span class="ow">in</span> <span class="n">LIB_EXT_LIST</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="get_computer_name"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_computer_name">[docs]</a><span class="k">def</span> <span class="nf">get_computer_name</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns machine name &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">COMPUTER_NAME</span>

</div>
<div class="viewcode-block" id="get_user_name"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_user_name">[docs]</a><span class="k">def</span> <span class="nf">get_user_name</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns user homefolder name &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">basename</span><span class="p">(</span><span class="n">truepath</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="get_install_dirs"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_install_dirs">[docs]</a><span class="k">def</span> <span class="nf">get_install_dirs</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">r&#39;C:\Program Files&#39;</span><span class="p">,</span> <span class="s">r&#39;C:\Program Files (x86)&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;/usr/bin&#39;</span><span class="p">,</span> <span class="s">&#39;/usr/local/bin&#39;</span><span class="p">,</span> <span class="s">&#39;~/bin&#39;</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="getroot"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.getroot">[docs]</a><span class="k">def</span> <span class="nf">getroot</span><span class="p">():</span>
    <span class="n">root</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;win32&#39;</span><span class="p">:</span> <span class="s">&#39;C:</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span>  <span class="c"># HACK</span>
        <span class="s">&#39;linux&#39;</span><span class="p">:</span> <span class="s">&#39;/&#39;</span><span class="p">,</span>
        <span class="s">&#39;darwin&#39;</span><span class="p">:</span> <span class="s">&#39;/&#39;</span><span class="p">,</span>
    <span class="p">}[</span><span class="n">OS_TYPE</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">root</span>

</div>
<div class="viewcode-block" id="startfile"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.startfile">[docs]</a><span class="k">def</span> <span class="nf">startfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">detatch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Uses default program defined by the system to open a file.</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/2692873/quote-posix-shell-special-characters-in-python-output</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[cplat] startfile(</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[cplat] fpath=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Cannot start nonexistant file: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
    <span class="c">#if quote:</span>
    <span class="c">#    fpath = &#39;&quot;%s&quot;&#39; % (fpath,)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">pipes</span>
        <span class="n">fpath</span> <span class="o">=</span> <span class="n">pipes</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">LINUX</span><span class="p">:</span>
        <span class="c">#out, err, ret = cmd([&#39;xdg-open&#39;, fpath], detatch=True)</span>
        <span class="n">outtup</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">((</span><span class="s">&#39;xdg-open&#39;</span><span class="p">,</span> <span class="n">fpath</span><span class="p">),</span> <span class="n">detatch</span><span class="o">=</span><span class="n">detatch</span><span class="p">)</span>
        <span class="c">#outtup = cmd(&#39;xdg-open&#39;, fpath, detatch=detatch)</span>
    <span class="k">elif</span> <span class="n">DARWIN</span><span class="p">:</span>
        <span class="n">outtup</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">((</span><span class="s">&#39;open&#39;</span><span class="p">,</span> <span class="n">fpath</span><span class="p">),</span> <span class="n">detatch</span><span class="o">=</span><span class="n">detatch</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Unknown Platform&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">outtup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">outtup</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s">&#39; -- &#39;</span> <span class="o">+</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="geteditor"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.geteditor">[docs]</a><span class="k">def</span> <span class="nf">geteditor</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;gvim&#39;</span>  <span class="c"># HACK (use util_profile)</span>

</div>
<div class="viewcode-block" id="editfile"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.editfile">[docs]</a><span class="k">def</span> <span class="nf">editfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Runs gvim &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[cplat] startfile(</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Cannot start nonexistant file: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">LINUX</span><span class="p">:</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">(</span><span class="n">geteditor</span><span class="p">(),</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">detatch</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s">&#39; -- &#39;</span> <span class="o">+</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">DARWIN</span><span class="p">:</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">(</span><span class="n">geteditor</span><span class="p">(),</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">detatch</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s">&#39; -- &#39;</span> <span class="o">+</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">(</span><span class="n">geteditor</span><span class="p">(),</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">detatch</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">out</span> <span class="o">+</span> <span class="s">&#39; -- &#39;</span> <span class="o">+</span> <span class="n">err</span><span class="p">)</span>
        <span class="c">#os.startfile(fpath)</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="view_directory"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.view_directory">[docs]</a><span class="k">def</span> <span class="nf">view_directory</span><span class="p">(</span><span class="n">dname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    view directory</span>

<span class="sd">    Args:</span>
<span class="sd">        dname (str): directory name</span>
<span class="sd">        verbose (bool):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_cplat --test-view_directory</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DOCTEST_DISABLE</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_cplat import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dname = ut.truepath(&#39;~&#39;)</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; view_directory(dname, verbose)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">utool.util_arg</span> <span class="kn">import</span> <span class="n">STRICT</span>
    <span class="kn">from</span> <span class="nn">utool.util_path</span> <span class="kn">import</span> <span class="n">checkpath</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[cplat] view_directory(</span><span class="si">%r</span><span class="s">) &#39;</span> <span class="o">%</span> <span class="n">dname</span><span class="p">)</span>
    <span class="n">dname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="k">if</span> <span class="n">dname</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">dname</span>
    <span class="n">open_prog</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;win32&#39;</span><span class="p">:</span> <span class="s">&#39;explorer.exe&#39;</span><span class="p">,</span>
        <span class="s">&#39;linux&#39;</span><span class="p">:</span> <span class="s">&#39;nautilus&#39;</span><span class="p">,</span>
        <span class="s">&#39;darwin&#39;</span><span class="p">:</span> <span class="s">&#39;open&#39;</span>
    <span class="p">}[</span><span class="n">OS_TYPE</span><span class="p">]</span>
    <span class="n">dname</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">dname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">STRICT</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">checkpath</span><span class="p">(</span><span class="n">dname</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dname</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dname</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">)):</span>
        <span class="n">dname</span> <span class="o">=</span> <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">dname</span>
    <span class="kn">import</span> <span class="nn">pipes</span>
    <span class="k">if</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="n">dname_</span> <span class="o">=</span> <span class="n">dname</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dname_</span> <span class="o">=</span> <span class="n">pipes</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">dname</span><span class="p">)</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">open_prog</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">dname_</span>
    <span class="k">print</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="c"># spawn deteched process</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">open_prog</span><span class="p">,</span> <span class="n">dname_</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="c">#import utool as ut</span>
    <span class="c">#ut.embed()</span>
    <span class="c">#pass</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[cplat] exit view directory&#39;</span><span class="p">)</span>

    <span class="c">#ret = os.system(command)</span>
    <span class="c">#print(&#39;ret = %r&#39; % (ret,))</span>

<span class="c"># Alias</span></div>
<span class="n">vd</span> <span class="o">=</span> <span class="n">view_directory</span>

<span class="n">get_resource_dir</span> <span class="o">=</span> <span class="n">meta_util_cplat</span><span class="o">.</span><span class="n">get_resource_dir</span>

<span class="n">get_app_resource_dir</span> <span class="o">=</span> <span class="n">meta_util_cplat</span><span class="o">.</span><span class="n">get_app_resource_dir</span>


<div class="viewcode-block" id="ensure_app_resource_dir"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.ensure_app_resource_dir">[docs]</a><span class="k">def</span> <span class="nf">ensure_app_resource_dir</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">app_resource_dir</span> <span class="o">=</span> <span class="n">get_app_resource_dir</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">app_resource_dir</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app_resource_dir</span>

</div>
<div class="viewcode-block" id="shell"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.shell">[docs]</a><span class="k">def</span> <span class="nf">shell</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dangerous. Take out of production code</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;shell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">cmd</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">__parse_cmd_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">detatch</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;detatch&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="c">#shell   = kwargs.get(&#39;shell&#39;, False)</span>
    <span class="c"># seems like linux needs the shell to work well</span>
    <span class="c"># maybe thats because I&#39;m a windows admin</span>
    <span class="c"># FIXME: Turn shell off by default and fix __parse_cmd_args</span>
    <span class="n">shell</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;shell&#39;</span><span class="p">,</span> <span class="n">LINUX</span> <span class="ow">or</span> <span class="n">DARWIN</span><span class="p">)</span>
    <span class="c"># TODO: gksudo</span>
    <span class="n">sudo</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sudo&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="c"># pads stdout of cmd before and after</span>
    <span class="c"># TODO: rename separate to something else</span>
    <span class="n">pad_stdout</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pad_stdout&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">detatch</span><span class="p">,</span> <span class="n">shell</span><span class="p">,</span> <span class="n">sudo</span><span class="p">,</span> <span class="n">pad_stdout</span>


<span class="k">def</span> <span class="nf">__parse_cmd_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">sudo</span><span class="p">,</span> <span class="n">shell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When shell is True, Popen will only accept strings. No tuples</span>
<span class="sd">    Shell really should not be true.</span>

<span class="sd">    Returns:</span>
<span class="sd">        args suitable for subprocess.Popen</span>

<span class="sd">        I&#39;m not quite sure what those are yet. Plain old string seem to work</span>
<span class="sd">        well? But I remember needing shlex at some point.</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_cplat --test-__parse_cmd_args</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_cplat import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; args = &#39;echo &quot;hello world&quot;&#39;</span>
<span class="sd">        &gt;&gt;&gt; sudo = False</span>
<span class="sd">        &gt;&gt;&gt; shell = False</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; args = __parse_cmd_args(args, sudo, shell)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; result = str(args)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Case where tuple is passed in as only argument</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">shell</span><span class="p">:</span>
        <span class="c"># When shell is False, ensure args is a string</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">args</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># When shell is False, ensure args is a tuple</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">posix</span><span class="o">=</span><span class="ow">not</span> <span class="n">WIN32</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">posix</span><span class="o">=</span><span class="ow">not</span> <span class="n">WIN32</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sudo</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">WIN32</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shell</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="s">&#39;sudo &#39;</span> <span class="o">+</span> <span class="n">args</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="s">&#39;sudo&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="c">#if isinstance(args, six.string_types):</span>
            <span class="c">#    args = shlex.split(args)</span>
            <span class="c">#args = [&#39;sudo&#39;] + args</span>
            <span class="c">## using sudo means we need to use a single string I believe</span>
            <span class="c">#args = &#39; &#39;.join(args)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># TODO: strip out sudos</span>
            <span class="k">pass</span>
    <span class="c"># HACK FOR WINDOWS AGAIN</span>
    <span class="c"># makes  this command work:</span>
    <span class="c"># python -c &quot;import utool as ut; ut.cmd(&#39;build\\hesaffexe.exe &#39; + ut.grab_test_imgpath(&#39;star.png&#39;))&quot;</span>
    <span class="c"># and this should still work</span>
    <span class="c"># python -c &quot;import utool as ut; ut.cmd(&#39;build\\hesaffexe.exe&#39;, ut.grab_test_imgpath(&#39;star.png&#39;))&quot;</span>
    <span class="k">if</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">posix</span><span class="o">=</span><span class="ow">not</span> <span class="n">WIN32</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span>


<div class="viewcode-block" id="run_realtime_process"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.run_realtime_process">[docs]</a><span class="k">def</span> <span class="nf">run_realtime_process</span><span class="p">(</span><span class="n">exe</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">exe</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="n">shell</span><span class="p">)</span>
    <span class="k">while</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">retcode</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span>  <span class="c"># returns None while subprocess is running</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">yield</span> <span class="n">line</span>
        <span class="k">if</span> <span class="n">retcode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">(</span><span class="s">&#39;process finished&#39;</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_run_process</span><span class="p">(</span><span class="n">proc</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c"># returns None while subprocess is running</span>
        <span class="n">retcode</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">yield</span> <span class="n">line</span>
        <span class="k">if</span> <span class="n">retcode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">(</span><span class="s">&#39;process finished&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="quote_single_command"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.quote_single_command">[docs]</a><span class="k">def</span> <span class="nf">quote_single_command</span><span class="p">(</span><span class="n">cmdstr</span><span class="p">):</span>
    <span class="k">if</span> <span class="s">&#39; &#39;</span> <span class="ow">in</span> <span class="n">cmdstr</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">cmdstr</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span>
    <span class="k">return</span> <span class="n">cmdstr</span>

</div>
<div class="viewcode-block" id="cmd"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.cmd">[docs]</a><span class="k">def</span> <span class="nf">cmd</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot; A really roundabout way to issue a system call</span>

<span class="sd">    # FIXME: This function needs some work</span>
<span class="sd">    # It should work without a hitch on windows or unix.</span>
<span class="sd">    # It should be able to spit out stdout in realtime.</span>
<span class="sd">    # Should be able to configure detatchment, shell, and sudo.</span>

<span class="sd">    FIXME:</span>
<span class="sd">        on a mac ut.cmd(&#39;/Users/joncrall/Library/Application Support/ibeis/tomcat/bin/shutdown.sh&#39;) will fail due to spaces</span>


<span class="sd">    Kwargs:</span>
<span class="sd">        quiet (bool) :</span>
<span class="sd">        silence (bool) :</span>
<span class="sd">        verbose (bool) :</span>
<span class="sd">        detatch (bool) :</span>
<span class="sd">        shell (bool) :</span>
<span class="sd">        sudo (bool) :</span>
<span class="sd">        pad_stdout (bool) :</span>
<span class="sd">        dryrun (bool) :</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (None, None, None)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_cplat --test-cmd:0</span>
<span class="sd">        python -m utool.util_cplat --test-cmd:1</span>
<span class="sd">        python -m utool.util_cplat --test-cmd:2</span>
<span class="sd">        python -m utool.util_cplat --test-cmd:1 --test-sudo</span>
<span class="sd">        python -m utool.util_cplat --test-cmd:2 --test-sudo</span>

<span class="sd">    Example0:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; (out, err, ret) = ut.cmd(&#39;echo&#39;, &#39;hello world&#39;)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.list_str(list(zip((&#39;out&#39;, &#39;err&#39;, &#39;ret&#39;), (out, err, ret))), nobraces=True)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        (&#39;out&#39;, &#39;hello world\n&#39;),</span>
<span class="sd">        (&#39;err&#39;, None),</span>
<span class="sd">        (&#39;ret&#39;, 0),</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; target = ut.codeblock(</span>
<span class="sd">        ...      r&#39;&#39;&#39;</span>
<span class="sd">                 (&#39;out&#39;, &#39;hello world\n&#39;),</span>
<span class="sd">                 (&#39;err&#39;, None),</span>
<span class="sd">                 (&#39;ret&#39;, 0),</span>
<span class="sd">                 &#39;&#39;&#39;)</span>
<span class="sd">        &gt;&gt;&gt; varydict = {</span>
<span class="sd">        ...    &#39;shell&#39;: [True, False],</span>
<span class="sd">        ...    &#39;detatch&#39;: [False],</span>
<span class="sd">        ...    &#39;sudo&#39;: [True, False] if ut.get_argflag(&#39;--test-sudo&#39;) else [False],</span>
<span class="sd">        ...    &#39;args&#39;: [&#39;echo hello world&#39;, (&#39;echo&#39;, &#39;hello world&#39;)],</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; for count, kw in enumerate(ut.all_dict_combinations(varydict), start=1):</span>
<span class="sd">        &gt;&gt;&gt;     print(&#39;+ --- TEST CMD %d ---&#39; % (count,))</span>
<span class="sd">        &gt;&gt;&gt;     print(&#39;testing cmd with params &#39; + ut.dict_str(kw))</span>
<span class="sd">        &gt;&gt;&gt;     args = kw.pop(&#39;args&#39;)</span>
<span class="sd">        &gt;&gt;&gt;     restup = ut.cmd(args, pad_stdout=False, **kw)</span>
<span class="sd">        &gt;&gt;&gt;     tupfields = (&#39;out&#39;, &#39;err&#39;, &#39;ret&#39;)</span>
<span class="sd">        &gt;&gt;&gt;     output = ut.list_str(list(zip(tupfields, restup)), nobraces=True)</span>
<span class="sd">        &gt;&gt;&gt;     ut.assert_eq(output, target)</span>
<span class="sd">        &gt;&gt;&gt;     print(&#39;L ___ TEST CMD %d ___\n&#39; % (count,))</span>

<span class="sd">    Example2:</span>
<span class="sd">        &gt;&gt;&gt; # UNSTABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # ping is not as universal of a command as I thought</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_cplat import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; varydict = {</span>
<span class="sd">        ...    &#39;shell&#39;: [True, False],</span>
<span class="sd">        ...    &#39;detatch&#39;: [True],</span>
<span class="sd">        ...    &#39;args&#39;: [&#39;ping localhost&#39;, (&#39;ping&#39;, &#39;localhost&#39;)],</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; proc_list = []</span>
<span class="sd">        &gt;&gt;&gt; for count, kw in enumerate(ut.all_dict_combinations(varydict), start=1):</span>
<span class="sd">        &gt;&gt;&gt;     print(&#39;+ --- TEST CMD %d ---&#39; % (count,))</span>
<span class="sd">        &gt;&gt;&gt;     print(&#39;testing cmd with params &#39; + ut.dict_str(kw))</span>
<span class="sd">        &gt;&gt;&gt;     args = kw.pop(&#39;args&#39;)</span>
<span class="sd">        &gt;&gt;&gt;     restup = ut.cmd(args, pad_stdout=False, **kw)</span>
<span class="sd">        &gt;&gt;&gt;     out, err, proc = restup</span>
<span class="sd">        &gt;&gt;&gt;     proc_list.append(proc)</span>
<span class="sd">        &gt;&gt;&gt;     print(proc)</span>
<span class="sd">        &gt;&gt;&gt;     print(proc)</span>
<span class="sd">        &gt;&gt;&gt;     print(proc.poll())</span>
<span class="sd">        &gt;&gt;&gt;     print(&#39;L ___ TEST CMD %d ___\n&#39; % (count,))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Parse the keyword arguments</span>
        <span class="n">quiet</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;quiet&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">silence</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;silence&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">detatch</span><span class="p">,</span> <span class="n">shell</span><span class="p">,</span> <span class="n">sudo</span><span class="p">,</span> <span class="n">pad_stdout</span> <span class="o">=</span> <span class="n">__parse_cmd_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pad_stdout</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">+--------&#39;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">__parse_cmd_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">sudo</span><span class="p">,</span> <span class="n">shell</span><span class="p">)</span>
        <span class="c"># Print what you are about to do</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ut.cmd] RUNNING: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">,))</span>
        <span class="c"># Open a subprocess with a pipe</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;dryrun&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ut.cmd] Exiting because dryrun=True&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="n">shell</span><span class="p">,</span>
                                <span class="n">universal_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">hack_use_stdout</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">detatch</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ut.cmd] PROCESS DETATCHING. No stdoutput can be reported...&#39;</span><span class="p">)</span>
            <span class="c"># There is no immediate confirmation as to whether or not the script</span>
            <span class="c"># finished. It might still be running for all you know</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">proc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">detatch</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ut.cmd] RUNNING WITH VERBOSE OUTPUT&#39;</span><span class="p">)</span>
                <span class="n">logged_out</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">_run_process</span><span class="p">(</span><span class="n">proc</span><span class="p">):</span>
                    <span class="c">#line_ = line if six.PY2 else line.decode(&#39;utf-8&#39;)</span>
                    <span class="n">line_</span> <span class="o">=</span> <span class="n">line</span> <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span> <span class="k">else</span> <span class="n">line</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">silence</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">hack_use_stdout</span><span class="p">:</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_</span><span class="p">)</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c"># TODO make this play nicely with loggers</span>
                                <span class="n">print_</span><span class="p">(</span><span class="n">line_</span><span class="p">)</span>
                        <span class="n">logged_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">logged_out</span><span class="p">)</span>
                <span class="p">(</span><span class="n">out_</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
                <span class="c">#print(&#39;[ut.cmd] out: %s&#39; % (out,))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ut.cmd] stdout: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">out_</span><span class="p">,))</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ut.cmd] stderr: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">err</span><span class="p">,))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Surpress output</span>
                <span class="c">#print(&#39;[ut.cmd] RUNNING WITH SUPRESSED OUTPUT&#39;)</span>
                <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
            <span class="c"># Make sure process if finished</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[ut.cmd] PROCESS FINISHED&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pad_stdout</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;L________</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ret</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
        <span class="c">#if isinstance(args, tuple):</span>
        <span class="c">#    print(ut.truepath(args[0]))</span>
        <span class="c">#elif isinstance(args, six.string_types):</span>
        <span class="c">#    print(ut.unixpath(args))</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;Exception running ut.cmd&#39;</span><span class="p">,</span>
                   <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="s">&#39;detatch&#39;</span><span class="p">,</span> <span class="s">&#39;shell&#39;</span><span class="p">,</span> <span class="s">&#39;sudo&#39;</span><span class="p">,</span> <span class="s">&#39;pad_stdout&#39;</span><span class="p">],</span>
                   <span class="n">tb</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_flops"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_flops">[docs]</a><span class="k">def</span> <span class="nf">get_flops</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; # DOESNT WORK &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">stdout</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;linpack.out&quot;</span>
    <span class="n">fpnum</span> <span class="o">=</span> <span class="s">r&#39;\d+\.\d+E[+-]\d\d&#39;</span>
    <span class="n">fpnum_1</span> <span class="o">=</span> <span class="n">fpnum</span> <span class="o">+</span> <span class="s">r&#39; +&#39;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&#39;^ *&#39;</span> <span class="o">+</span> <span class="n">fpnum_1</span> <span class="o">+</span> <span class="n">fpnum_1</span> <span class="o">+</span> <span class="n">fpnum_1</span> <span class="o">+</span> <span class="s">r&#39;(&#39;</span> <span class="o">+</span> <span class="n">fpnum</span> <span class="o">+</span> <span class="s">r&#39;) +&#39;</span> <span class="o">+</span> <span class="n">fpnum_1</span> <span class="o">+</span> <span class="n">fpnum</span> <span class="o">+</span> <span class="s">r&#39; *\n$&#39;</span><span class="p">)</span>
    <span class="n">speeds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0e75</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="nb">file</span> <span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\1&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="n">speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span>
            <span class="n">speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">speeds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">speeds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
    <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">:</span>
        <span class="n">speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">count</span>

    <span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.1f</span><span class="s"> MFlops (</span><span class="si">%d</span><span class="s"> from </span><span class="si">%.1f</span><span class="s"> to </span><span class="si">%.1f</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">speeds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">count</span><span class="p">,</span> <span class="n">speeds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">speeds</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

</div>
<div class="viewcode-block" id="set_process_title"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.set_process_title">[docs]</a><span class="k">def</span> <span class="nf">set_process_title</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">setproctitle</span>
        <span class="n">setproctitle</span><span class="o">.</span><span class="n">setproctitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="is64bit_python"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.is64bit_python">[docs]</a><span class="k">def</span> <span class="nf">is64bit_python</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if running 64 bit python and False if running on 32 bit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#http://stackoverflow.com/questions/1405913/how-do-i-determine-if-my-python-shell-is-executing-in-32bit-or-64bit-mode-on-os</span>
    <span class="n">is64bit</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">32</span>
    <span class="c">#import platform</span>
    <span class="c">#platform.architecture()</span>
    <span class="c">#import ctypes</span>
    <span class="c">#(ctypes.sizeof(ctypes.c_voidp))</span>
    <span class="k">return</span> <span class="n">is64bit</span>

</div>
<div class="viewcode-block" id="get_python_dynlib"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_python_dynlib">[docs]</a><span class="k">def</span> <span class="nf">get_python_dynlib</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    python -c &quot;import utool; print(utool.get_python_dynlib())&quot;</span>

<span class="sd">    get_python_dynlib</span>

<span class="sd">    Returns:</span>
<span class="sd">        ?: dynlib</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DOCTEST_DISABLE</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_cplat import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dynlib = get_python_dynlib()</span>
<span class="sd">        &gt;&gt;&gt; print(dynlib)</span>
<span class="sd">        /usr/lib/x86_64-linux-gnu/libpython2.7.so</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sysconfig</span>
    <span class="n">cfgvars</span> <span class="o">=</span> <span class="n">sysconfig</span><span class="o">.</span><span class="n">get_config_vars</span><span class="p">()</span>
    <span class="n">dynlib</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfgvars</span><span class="p">[</span><span class="s">&#39;LIBDIR&#39;</span><span class="p">],</span> <span class="n">cfgvars</span><span class="p">[</span><span class="s">&#39;MULTIARCH&#39;</span><span class="p">],</span> <span class="n">cfgvars</span><span class="p">[</span><span class="s">&#39;LDLIBRARY&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">dynlib</span><span class="p">):</span>
        <span class="n">dynlib</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfgvars</span><span class="p">[</span><span class="s">&#39;LIBDIR&#39;</span><span class="p">],</span> <span class="n">cfgvars</span><span class="p">[</span><span class="s">&#39;LDLIBRARY&#39;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">exists</span><span class="p">(</span><span class="n">dynlib</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dynlib</span>

</div>
<div class="viewcode-block" id="get_path_dirs"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.get_path_dirs">[docs]</a><span class="k">def</span> <span class="nf">get_path_dirs</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns a list of directories in the PATH system variable</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: pathdirs</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_cplat --exec-get_path_dirs</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # SCRIPT</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_cplat import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; pathdirs = get_path_dirs()</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;pathdirs = %s&#39; % (ut.list_str(pathdirs),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pathdirs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;PATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pathdirs</span>

</div>
<div class="viewcode-block" id="print_path"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.print_path">[docs]</a><span class="k">def</span> <span class="nf">print_path</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">pathdirs</span> <span class="o">=</span> <span class="n">get_path_dirs</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="n">pathdirs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pathdirs</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathdirs</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="search_env_paths"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.search_env_paths">[docs]</a><span class="k">def</span> <span class="nf">search_env_paths</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Searches your PATH to see if fname exists</span>

<span class="sd">    Args:</span>
<span class="sd">        fname (str): file name to search for</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_cplat --test-search_env_paths</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_cplat import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; fname = &#39;opencv2/highgui/libopencv_highgui.so&#39;</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; result = search_env_paths(fname)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>

<span class="sd">    Ignore:</span>
<span class="sd">        OpenCV_DIR:PATH={share_opencv}</span>
<span class="sd">        OpenCV_CONFIG_PATH:FILEPATH={share_opencv}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;PATH&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_list</span><span class="p">:</span>
        <span class="n">dpath_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dpath</span> <span class="ow">in</span> <span class="n">dpath_list</span><span class="p">:</span>
            <span class="n">testname</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">testname</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Found in key=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,))</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">testname</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="change_term_title"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.change_term_title">[docs]</a><span class="k">def</span> <span class="nf">change_term_title</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    only works on unix systems only tested on Ubuntu GNOME changes text on</span>
<span class="sd">    terminal title for identifying debugging tasks.</span>

<span class="sd">    The title will remain until python exists</span>

<span class="sd">    Args:</span>
<span class="sd">        title (str):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_cplat --test-change_term_title</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_cplat import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;change title test&#39;</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; result = change_term_title(title)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="n">cmd_str</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;echo -en &quot;\033]0;&#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\a</span><span class="s">&quot;&#39;&#39;&#39;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="send_keyboard_input"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.send_keyboard_input">[docs]</a><span class="k">def</span> <span class="nf">send_keyboard_input</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">key_list</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        text (None):</span>
<span class="sd">        key_list (list):</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/14788036/python-win32api-sendmesage</span>
<span class="sd">        http://www.pinvoke.net/default.aspx/user32.sendinput</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_cplat --test-send_keyboard_input</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_cplat import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;%paste&#39;</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; result = send_keyboard_input(&#39;%paste&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#key_mapping = {</span>
    <span class="c">#    &#39;enter&#39;:</span>
    <span class="c">#}</span>
    <span class="k">if</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="c">#raise NotImplementedError()</span>
        <span class="c">#import win32api</span>
        <span class="c">#import win32gui</span>
        <span class="c">#import win32con</span>
        <span class="c">#hwnd = win32gui.GetForegroundWindow()</span>
        <span class="c">#print(&#39;entering text into %r&#39; % (win32gui.GetWindowText(hwnd ),))</span>
        <span class="c">#win32con.VK_RETURN</span>

        <span class="c">#def callback(hwnd, hwnds):</span>
            <span class="c">#if win32gui.IsWindowVisible(hwnd) and win32gui.IsWindowEnabled(hwnd):</span>
                <span class="c">#hwnds[win32gui.GetClassName(hwnd)] = hwnd</span>
            <span class="c">#return True</span>
        <span class="c">#hwnds = {}</span>
        <span class="c">#win32gui.EnumChildWindows(hwnd, callback, hwnds)</span>

        <span class="c">#for ord_char in map(ord, text):</span>
            <span class="c">#win32api.SendMessage(hwnd, win32con.WM_CHAR, ord_char, 0)</span>
        <span class="kn">from</span> <span class="nn">utool._internal</span> <span class="kn">import</span> <span class="n">win32_send_keys</span>
        <span class="n">pause</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="o">.</span><span class="mo">05</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;paste&#39;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">text</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">with_spaces</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_tabs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_newlines</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">win32_send_keys</span><span class="o">.</span><span class="n">SendKeys</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="n">pause</span><span class="p">,</span> <span class="n">turn_off_numlock</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="c">#win32_send_keys</span>
        <span class="c">#import time</span>
        <span class="c">#keys_ = win32_send_keys.parse_keys(keys, **kw)</span>
        <span class="c">#for k in keys_:</span>
        <span class="c">#    k.Run()</span>
        <span class="c">#    time.sleep(pause)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">char_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;%&#39;</span><span class="p">:</span> <span class="s">&#39;shift+5&#39;</span>
            <span class="p">}</span>
            <span class="n">key_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">char_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">]</span>
        <span class="n">xdotool_args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;xdotool&#39;</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">key_list</span>
        <span class="c">#, &#39;shift+5&#39;, &#39;p&#39;, &#39;a&#39;, &#39;s&#39;, &#39;t&#39;, &#39;e&#39;, &#39;enter&#39;]</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xdotool_args</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Running: cmd=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">,))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;+---&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;L___&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ipython_paste"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.ipython_paste">[docs]</a><span class="k">def</span> <span class="nf">ipython_paste</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; pastes for me FIXME: make something like this work on unix and windows&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">WIN32</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">winhandle</span> <span class="o">=</span> <span class="s">&#39;joncrall@Hyrule&#39;</span>
        <span class="n">args1</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;wmctrl&#39;</span><span class="p">,</span> <span class="s">&#39;-a&#39;</span><span class="p">,</span> <span class="n">winhandle</span><span class="p">]</span>
        <span class="n">args2</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;xdotool&#39;</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;shift+5&#39;</span><span class="p">,</span> <span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="s">&#39;enter&#39;</span><span class="p">]</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args1</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args2</span><span class="p">))</span>

    <span class="c">#fallback_execute(args1)</span>
    <span class="c">#fallback_execute(args2)</span>

</div>
<div class="viewcode-block" id="spawn_delayed_ipython_paste"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.spawn_delayed_ipython_paste">[docs]</a><span class="k">def</span> <span class="nf">spawn_delayed_ipython_paste</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="c"># Gonna be pasting</span>
    <span class="k">def</span> <span class="nf">delayed_ipython_paste</span><span class="p">(</span><span class="n">delay</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
        <span class="c">#import os</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;waiting&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">send_keyboard_input</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;%paste&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">send_keyboard_input</span><span class="p">(</span><span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;KP_Enter&#39;</span><span class="p">])</span>
        <span class="c">#os.system(&#39; &#39;.join([&#39;xdotool&#39;, &#39;key&#39;, &#39;shift+5&#39;, &#39;p&#39;, &#39;a&#39;, &#39;s&#39;, &#39;t&#39;, &#39;e&#39;, &#39;KP_Enter&#39;]))</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">spawn_background_thread</span><span class="p">(</span><span class="n">delayed_ipython_paste</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="print_system_users"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.print_system_users">[docs]</a><span class="k">def</span> <span class="nf">print_system_users</span><span class="p">():</span>
    <span class="sd">r&quot;&quot;&quot;</span>

<span class="sd">    prints users on the system</span>

<span class="sd">    On unix looks for /bin/bash users in /etc/passwd</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_cplat --test-print_system_users</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # SCRIPT</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_cplat import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; result = print_system_users()</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">read_from</span><span class="p">(</span><span class="s">&#39;/etc/passwd&#39;</span><span class="p">)</span>
    <span class="n">userinfo_text_list</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">userinfo_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">uitext</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">uitext</span> <span class="ow">in</span> <span class="n">userinfo_text_list</span><span class="p">]</span>
    <span class="c">#print(ut.list_str(sorted(userinfo_list)))</span>
    <span class="n">bash_users</span> <span class="o">=</span> <span class="p">[</span><span class="n">tup</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">userinfo_list</span> <span class="k">if</span> <span class="n">tup</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;/bin/bash&#39;</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">list_str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">bash_users</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="check_installed_debian"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.check_installed_debian">[docs]</a><span class="k">def</span> <span class="nf">check_installed_debian</span><span class="p">(</span><span class="n">pkgname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References:</span>
<span class="sd">        http://www.cyberciti.biz/faq/find-out-if-package-is-installed-in-linux/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="c">#pkgname = &#39;espeak&#39;</span>
    <span class="c">#pkgname = &#39;sudo&#39;</span>
    <span class="c">#ut.cmd(&#39;hash &#39; + pkgname + &#39; 2&gt;/dev/null&#39;)</span>
    <span class="n">tup</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s">&#39;hash &#39;</span> <span class="o">+</span> <span class="n">pkgname</span> <span class="o">+</span> <span class="s">&#39; 2&gt;/dev/null&#39;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">pad_stdout</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">tup</span>
    <span class="n">is_installed</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">is_installed</span>

</div>
<div class="viewcode-block" id="assert_installed_debian"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.assert_installed_debian">[docs]</a><span class="k">def</span> <span class="nf">assert_installed_debian</span><span class="p">(</span><span class="n">pkgname</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">check_installed_debian</span><span class="p">(</span><span class="n">pkgname</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;espeak must be installed. run sudo apt-get install -y &#39;</span> <span class="o">+</span> <span class="n">pkgname</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="unload_module"><a class="viewcode-back" href="../../utool.html#utool.util_cplat.unload_module">[docs]</a><span class="k">def</span> <span class="nf">unload_module</span><span class="p">(</span><span class="n">modname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    WARNING POTENTIALLY DANGEROUS AND MAY NOT WORK</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/437589/how-do-i-unload-reload-a-python-module</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_cplat --test-unload_module</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import sys, gc  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import pyhesaff</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; modname = &#39;pyhesaff&#39;</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;%s refcount=%r&#39; % (modname, sys.getrefcount(pyhesaff),))</span>
<span class="sd">        &gt;&gt;&gt; #referrer_list = gc.get_referrers(sys.modules[modname])</span>
<span class="sd">        &gt;&gt;&gt; #print(&#39;referrer_list = %s&#39; % (ut.list_str(referrer_list),))</span>
<span class="sd">        &gt;&gt;&gt; ut.unload_module(modname)</span>
<span class="sd">        &gt;&gt;&gt; assert pyhesaff is None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">gc</span>
    <span class="k">if</span> <span class="n">modname</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="n">referrer_list</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_referrers</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">modname</span><span class="p">])</span>
        <span class="c">#module = sys.modules[modname]</span>
        <span class="k">for</span> <span class="n">referer</span> <span class="ow">in</span> <span class="n">referrer_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">referer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                <span class="n">referer</span><span class="p">[</span><span class="n">modname</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="c">#del referer[modname]</span>
        <span class="c">#sys.modules[modname] = module</span>
        <span class="c">#del module</span>
        <span class="n">refcount</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">modname</span><span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> refcount=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">refcount</span><span class="p">))</span>
        <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">modname</span><span class="p">]</span>


<span class="c">#def get_ipython_config_file():</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#    or to create an empty default profile, populated with default config files:</span>
<span class="c">#    ipython profile create</span>
<span class="c">#    &quot;&quot;&quot;</span>

<span class="c">#from subprocess import check_output</span>
<span class="c">#http://stackoverflow.com/questions/8015163/how-to-check-screen-is-running</span>
<span class="c">#def screen_present(name):</span>
<span class="c">#        var = check_output([&quot;screen -ls; true&quot;],shell=True)</span>
<span class="c">#        if &quot;.&quot;+name+&quot;\t(&quot; in var:</span>
<span class="c">#                print name+&quot; is running&quot;</span>
<span class="c">#        else:</span>
<span class="c">#                print name+&quot; is not running&quot;</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -c &quot;import utool, utool.util_cplat; utool.doctest_funcs(utool.util_cplat, allexamples=True)&quot;</span>
<span class="sd">        python -c &quot;import utool, utool.util_cplat; utool.doctest_funcs(utool.util_cplat)&quot;</span>
<span class="sd">        python -m utool.util_cplat</span>
<span class="sd">        python -m utool.util_cplat --allexamples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>  <span class="c"># NOQA</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Jon Crall.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.1.2.dev1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
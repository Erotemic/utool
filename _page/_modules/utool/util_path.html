

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>utool.util_path &mdash; utool 1.1.2.dev1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="utool 1.1.2.dev1 documentation" href="../../index.html"/>
        <link rel="up" title="utool" href="../utool.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> utool
          

          
          </a>

          
            
            
              <div class="version">
                1.1.2.dev1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../utool.html">utool package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">utool</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../utool.html">utool</a> &raquo;</li>
      
    <li>utool.util_path</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for utool.util_path</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">python -c &quot;import utool, doctest; print(doctest.testmod(utool.util_path))&quot;</span>

<span class="sd">This module becomes nav</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">zip</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">filterfalse</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">range</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="p">(</span><span class="n">join</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">normpath</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">isdir</span><span class="p">,</span> <span class="n">isfile</span><span class="p">,</span>
                     <span class="n">exists</span><span class="p">,</span> <span class="n">islink</span><span class="p">,</span> <span class="n">ismount</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">realpath</span><span class="p">,</span>
                     <span class="n">splitdrive</span><span class="p">,</span> <span class="n">commonprefix</span><span class="p">,</span> <span class="n">expanduser</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">utool.util_regex</span> <span class="kn">import</span> <span class="n">extend_regex</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_dbg</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_progress</span>
<span class="kn">from</span> <span class="nn">utool._internal</span> <span class="kn">import</span> <span class="n">meta_util_path</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_inject</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_arg</span>
<span class="kn">from</span> <span class="nn">utool._internal.meta_util_arg</span> <span class="kn">import</span> <span class="n">NO_ASSERTS</span><span class="p">,</span> <span class="n">VERBOSE</span><span class="p">,</span> <span class="n">VERYVERBOSE</span><span class="p">,</span> <span class="n">QUIET</span>
<span class="k">print</span><span class="p">,</span> <span class="n">print_</span><span class="p">,</span> <span class="n">printDBG</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">util_inject</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;[util_path]&#39;</span><span class="p">)</span>


<span class="n">PRINT_CALLER</span> <span class="o">=</span> <span class="n">util_arg</span><span class="o">.</span><span class="n">get_argflag</span><span class="p">(</span><span class="s">&#39;--print-caller&#39;</span><span class="p">)</span>  <span class="c"># FIXME: name</span>

<span class="n">__IMG_EXTS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s">&#39;.png&#39;</span><span class="p">,</span> <span class="s">&#39;.tif&#39;</span><span class="p">,</span> <span class="s">&#39;.tiff&#39;</span><span class="p">,</span> <span class="s">&#39;.ppm&#39;</span><span class="p">]</span>
<span class="n">__LOWER_EXTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">__IMG_EXTS</span><span class="p">)</span>
<span class="n">__UPPER_EXTS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ext</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">__IMG_EXTS</span><span class="p">)</span>
<span class="n">IMG_EXTENSIONS</span> <span class="o">=</span>  <span class="nb">set</span><span class="p">(</span><span class="n">__LOWER_EXTS</span> <span class="o">+</span> <span class="n">__UPPER_EXTS</span><span class="p">)</span>


<div class="viewcode-block" id="newcd"><a class="viewcode-back" href="../../utool.html#utool.util_path.newcd">[docs]</a><span class="k">def</span> <span class="nf">newcd</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; DEPRICATE &quot;&quot;&quot;</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cwd</span>

</div>
<span class="n">unixpath</span> <span class="o">=</span> <span class="n">meta_util_path</span><span class="o">.</span><span class="n">unixpath</span>
<span class="n">truepath</span> <span class="o">=</span> <span class="n">meta_util_path</span><span class="o">.</span><span class="n">truepath</span>
<span class="n">unixjoin</span> <span class="o">=</span> <span class="n">meta_util_path</span><span class="o">.</span><span class="n">unixjoin</span>


<div class="viewcode-block" id="ensure_ext"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensure_ext">[docs]</a><span class="k">def</span> <span class="nf">ensure_ext</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">ext</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        fname (str):  file name</span>
<span class="sd">        ext (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: fname -  file name</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --exec-ensure_ext --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; print(ensure_ext(&#39;foo&#39;, &#39;.bar&#39;))</span>
<span class="sd">        &gt;&gt;&gt; print(ensure_ext(&#39;foo.bar&#39;, &#39;.bar&#39;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname_</span><span class="p">,</span> <span class="n">ext_</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="o">!=</span> <span class="n">ext_</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname_</span> <span class="o">+</span> <span class="n">ext_</span> <span class="o">+</span> <span class="n">ext</span>
    <span class="k">return</span> <span class="n">fname</span>

</div>
<div class="viewcode-block" id="relpath_unix"><a class="viewcode-back" href="../../utool.html#utool.util_path.relpath_unix">[docs]</a><span class="k">def</span> <span class="nf">relpath_unix</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">otherpath</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">otherpath</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="truepath_relative"><a class="viewcode-back" href="../../utool.html#utool.util_path.truepath_relative">[docs]</a><span class="k">def</span> <span class="nf">truepath_relative</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">otherpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Normalizes and returns absolute path with so specs</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str):  path to file or directory</span>
<span class="sd">        otherpath (None): (default = None)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: path_</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --exec-truepath_relative --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; path = &#39;C:/foobar/foobiz&#39;</span>
<span class="sd">        &gt;&gt;&gt; otherpath = &#39;C:/foobar&#39;</span>
<span class="sd">        &gt;&gt;&gt; path_ = truepath_relative(path, otherpath)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;path_ = %s&#39; % (ut.repr2(path_),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        path_ = &#39;foobiz&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">otherpath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">otherpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">otherpath</span> <span class="o">=</span> <span class="n">truepath</span><span class="p">(</span><span class="n">otherpath</span><span class="p">)</span>
    <span class="n">path_</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">otherpath</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">path_</span>

</div>
<div class="viewcode-block" id="tail"><a class="viewcode-back" href="../../utool.html#utool.util_path.tail">[docs]</a><span class="k">def</span> <span class="nf">tail</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">trailing</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Alias for path_ndir_split &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">path_ndir_split</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">trailing</span><span class="o">=</span><span class="n">trailing</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="unexpanduser"><a class="viewcode-back" href="../../utool.html#utool.util_path.unexpanduser">[docs]</a><span class="k">def</span> <span class="nf">unexpanduser</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">homedir</span> <span class="o">=</span> <span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">homedir</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s">&#39;~&#39;</span> <span class="o">+</span> <span class="n">path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">homedir</span><span class="p">):]</span>
    <span class="k">return</span> <span class="n">path</span>

</div>
<div class="viewcode-block" id="path_ndir_split"><a class="viewcode-back" href="../../utool.html#utool.util_path.path_ndir_split">[docs]</a><span class="k">def</span> <span class="nf">path_ndir_split</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">force_unix</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">winroot</span><span class="o">=</span><span class="s">&#39;C:&#39;</span><span class="p">,</span> <span class="n">trailing</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Shows only a little bit of the path. Up to the n bottom-level directories</span>

<span class="sd">    TODO: rename to path_tail? ndir_split?</span>

<span class="sd">    Returns:</span>
<span class="sd">        (str) the trailing n paths of path.</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python3 -m utool.util_path --test-path_ndir_split</span>
<span class="sd">        python3 -m utool --tf path_ndir_split</span>
<span class="sd">        python -m utool --tf path_ndir_split</span>


<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; paths = [r&#39;/usr/bin/local/foo/bar&#39;,</span>
<span class="sd">        ...          r&#39;C:/&#39;,</span>
<span class="sd">        ...          #r&#39;lonerel&#39;,</span>
<span class="sd">        ...          #r&#39;reldir/other&#39;,</span>
<span class="sd">        ...          r&#39;/ham&#39;,</span>
<span class="sd">        ...          r&#39;./eggs&#39;,</span>
<span class="sd">        ...          r&#39;/spam/eggs&#39;,</span>
<span class="sd">        ...          r&#39;C:\Program Files (x86)/foobar/bin&#39;,]</span>
<span class="sd">        &gt;&gt;&gt; N = 2</span>
<span class="sd">        &gt;&gt;&gt; iter_ = ut.iprod(paths, range(1, N + 1))</span>
<span class="sd">        &gt;&gt;&gt; force_unix = True</span>
<span class="sd">        &gt;&gt;&gt; tuplist = [(n, path_ndir_split(path_, n)) for path_, n in iter_]</span>
<span class="sd">        &gt;&gt;&gt; chunklist = list(ut.ichunks(tuplist, N))</span>
<span class="sd">        &gt;&gt;&gt; list_ = [[&#39;n=%r: %s&#39; % (x, ut.reprfunc(y)) for x, y in chunk]</span>
<span class="sd">        &gt;&gt;&gt;          for chunk in chunklist]</span>
<span class="sd">        &gt;&gt;&gt; line_list = [&#39;, &#39;.join(strs) for strs in list_]</span>
<span class="sd">        &gt;&gt;&gt; result = &#39;\n&#39;.join(line_list)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        n=1: &#39;.../bar&#39;, n=2: &#39;.../foo/bar&#39;</span>
<span class="sd">        n=1: &#39;C:/&#39;, n=2: &#39;C:/&#39;</span>
<span class="sd">        n=1: &#39;.../ham&#39;, n=2: &#39;/ham&#39;</span>
<span class="sd">        n=1: &#39;.../eggs&#39;, n=2: &#39;./eggs&#39;</span>
<span class="sd">        n=1: &#39;.../eggs&#39;, n=2: &#39;.../spam/eggs&#39;</span>
<span class="sd">        n=1: &#39;.../bin&#39;, n=2: &#39;.../foobar/bin&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ensure_crossplat_path</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span> <span class="k">if</span> <span class="n">force_unix</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
    <span class="n">ndirs_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">path_</span>
    <span class="n">reached_end</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">nx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="c">#print(&#39;--&#39;)</span>
        <span class="c">#print(&#39;IN head = %r&#39; % (head,))</span>
        <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
        <span class="c">#print(&#39;head = %r&#39; % (head,))</span>
        <span class="c">#print(&#39;tail = %r&#39; % (tail,))</span>
        <span class="k">if</span> <span class="n">tail</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">head</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">reached_end</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">head</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ndirs_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">head</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">/&#39;</span><span class="p">)</span>
                <span class="n">ndirs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                <span class="n">reached_end</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ndirs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
        <span class="c">#print(&#39;ndirs_list = %r&#39; % (ndirs_list,))</span>
    <span class="k">if</span> <span class="n">trailing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">reached_end</span><span class="p">:</span>
        <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
        <span class="c">#print(&#39;--&#39;)</span>
        <span class="c">#print(&#39;head = %r&#39; % (head,))</span>
        <span class="c">#print(&#39;tail = %r&#39; % (tail,))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">head</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># or head == &#39;/&#39;:</span>
                <span class="n">reached_end</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c">#if head == &#39;/&#39;:</span>
    <span class="c">#    reached_end = True</span>
    <span class="n">ndirs</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ndirs_list</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cplat_path</span> <span class="o">=</span> <span class="n">ensure_crossplat_path</span><span class="p">(</span><span class="n">ndirs</span><span class="p">)</span>
    <span class="c">#if trailing and not reached_end:</span>
    <span class="k">if</span> <span class="n">trailing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">reached_end</span><span class="p">:</span>
        <span class="n">cplat_path</span> <span class="o">=</span> <span class="s">&#39;.../&#39;</span> <span class="o">+</span> <span class="n">cplat_path</span>
    <span class="c">#print(&#39;cplat_path = %r&#39; % (cplat_path,))</span>
    <span class="c">#print(&#39;--&#39;)</span>
    <span class="k">return</span> <span class="n">cplat_path</span>

</div>
<div class="viewcode-block" id="remove_file"><a class="viewcode-back" href="../../utool.html#utool.util_path.remove_file">[docs]</a><span class="k">def</span> <span class="nf">remove_file</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Removes a file &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dryrun</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Dryrem </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Removed </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path.remove_file] Misrem </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
            <span class="c">#warnings.warn(&#39;OSError: %s,\n Could not delete %s&#39; % (str(e), fpath))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_errors</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="remove_dirs"><a class="viewcode-back" href="../../utool.html#utool.util_path.remove_dirs">[docs]</a><span class="k">def</span> <span class="nf">remove_dirs</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">QUIET</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Recursively removes a single directory (need to change function name)</span>

<span class="sd">    DEPRICATE</span>

<span class="sd">    Args:</span>
<span class="sd">        dpath (str):  directory path</span>
<span class="sd">        dryrun (bool): (default = False)</span>
<span class="sd">        ignore_errors (bool): (default = True)</span>
<span class="sd">        quiet (bool): (default = False)</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: False</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-remove_dirs</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dpath = ut.ensure_app_resource_dir(&#39;utool&#39;, &#39;testremovedir&#39;)</span>
<span class="sd">        &gt;&gt;&gt; assert exists(dpath), &#39;nothing to remove&#39;</span>
<span class="sd">        &gt;&gt;&gt; dryrun = False</span>
<span class="sd">        &gt;&gt;&gt; ignore_errors = True</span>
<span class="sd">        &gt;&gt;&gt; quiet = False</span>
<span class="sd">        &gt;&gt;&gt; flag = remove_dirs(dpath, dryrun, ignore_errors, quiet)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;flag = %s&#39; % (flag,))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; assert not exists(dpath), &#39;did not remove dpath&#39;</span>
<span class="sd">        flag = True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Removing directory: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dryrun</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dpath</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;OSError: </span><span class="si">%s</span><span class="s">,</span><span class="se">\n</span><span class="s"> Could not delete </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">dpath</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_errors</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="c">#import os</span>

</div>
<div class="viewcode-block" id="augpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.augpath">[docs]</a><span class="k">def</span> <span class="nf">augpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">augsuf</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">augext</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">augpref</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">augdir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">newext</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">newfname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ensure</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    augments end of path before the extension.</span>

<span class="sd">    augpath</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str):</span>
<span class="sd">        augsuf (str): augment filename before extension</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: newpath</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; path = &#39;somefile.txt&#39;</span>
<span class="sd">        &gt;&gt;&gt; augsuf = &#39;_aug&#39;</span>
<span class="sd">        &gt;&gt;&gt; newpath = augpath(path, augsuf)</span>
<span class="sd">        &gt;&gt;&gt; result = str(newpath)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        somefile_aug.txt</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; path = &#39;somefile.txt&#39;</span>
<span class="sd">        &gt;&gt;&gt; augsuf = &#39;_aug2&#39;</span>
<span class="sd">        &gt;&gt;&gt; newext = &#39;.bak&#39;</span>
<span class="sd">        &gt;&gt;&gt; augdir = &#39;backup&#39;</span>
<span class="sd">        &gt;&gt;&gt; newpath = augpath(path, augsuf, newext=newext, augdir=augdir)</span>
<span class="sd">        &gt;&gt;&gt; result = str(newpath)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        backup/somefile_aug2.bak</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Breakup path</span>
    <span class="n">dpath</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">fname_noext</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newfname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fname_noext</span> <span class="o">=</span> <span class="n">newfname</span>
    <span class="c"># Augment ext</span>
    <span class="k">if</span> <span class="n">newext</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">newext</span> <span class="o">=</span> <span class="n">ext</span>
    <span class="c"># Augment fname</span>
    <span class="n">new_fname</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">augpref</span><span class="p">,</span> <span class="n">fname_noext</span><span class="p">,</span> <span class="n">augsuf</span><span class="p">,</span> <span class="n">newext</span><span class="p">,</span> <span class="n">augext</span><span class="p">))</span>
    <span class="c"># Augment dpath</span>
    <span class="k">if</span> <span class="n">augdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">new_dpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">augdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ensure</span><span class="p">:</span>
            <span class="c"># create new dir if needebe</span>
            <span class="n">ensuredir</span><span class="p">(</span><span class="n">new_dpath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_dpath</span> <span class="o">=</span> <span class="n">dpath</span>
    <span class="c"># Recombine into new path</span>
    <span class="n">newpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">new_dpath</span><span class="p">,</span> <span class="n">new_fname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newpath</span>

</div>
<div class="viewcode-block" id="touch"><a class="viewcode-back" href="../../utool.html#utool.util_path.touch">[docs]</a><span class="k">def</span> <span class="nf">touch</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        fname (str)</span>
<span class="sd">        times (None):</span>
<span class="sd">        verbose (bool):</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; fname = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; times = None</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; result = touch(fname, times, verbose)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/1158076/implement-touch-using-python</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] touching </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span>
        <span class="n">utool</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;touch </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
        <span class="k">raise</span>

</div>
<div class="viewcode-block" id="remove_files_in_dir"><a class="viewcode-back" href="../../utool.html#utool.util_path.remove_files_in_dir">[docs]</a><span class="k">def</span> <span class="nf">remove_files_in_dir</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">fname_pattern_list</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Removes files matching a pattern from a directory &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname_pattern_list</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">fname_pattern_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">fname_pattern_list</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Removing files:&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;  * from dpath = </span><span class="si">%r</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">dpath</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;  * with patterns = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fname_pattern_list</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;  * recursive = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">recursive</span><span class="p">)</span>
    <span class="n">num_removed</span><span class="p">,</span> <span class="n">num_matched</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s">&#39;dryrun&#39;</span><span class="p">:</span> <span class="n">dryrun</span><span class="p">,</span>
        <span class="s">&#39;verbose&#39;</span><span class="p">:</span> <span class="n">verbose</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">dpath</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;!!! dir = </span><span class="si">%r</span><span class="s"> does not exist!&#39;</span> <span class="o">%</span> <span class="n">dpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dname_list</span><span class="p">,</span> <span class="n">fname_list</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dpath</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fname_pattern</span> <span class="ow">in</span> <span class="n">fname_pattern_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">fname_list</span><span class="p">,</span> <span class="n">fname_pattern</span><span class="p">):</span>
                <span class="n">num_matched</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">num_removed</span> <span class="o">+=</span> <span class="n">remove_file</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span>
                                           <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] ... Removed </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> files&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_removed</span><span class="p">,</span> <span class="n">num_matched</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="delete"><a class="viewcode-back" href="../../utool.html#utool.util_path.delete">[docs]</a><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span>
           <span class="n">print_exists</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Removes a file or directory &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Deleting path=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">print_exists</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;..does not exist!&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">rmargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dryrun</span><span class="o">=</span><span class="n">dryrun</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                  <span class="n">ignore_errors</span><span class="o">=</span><span class="n">ignore_errors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">remove_files_in_dir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">rmargs</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="ow">and</span> <span class="n">remove_dirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">rmargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">remove_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">rmargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Unknown type of path=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="p">(</span><span class="n">path</span><span class="p">,))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">QUIET</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Finished deleting path=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flag</span>

</div>
<div class="viewcode-block" id="remove_existing_fpaths"><a class="viewcode-back" href="../../utool.html#utool.util_path.remove_existing_fpaths">[docs]</a><span class="k">def</span> <span class="nf">remove_existing_fpaths</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">QUIET</span><span class="p">,</span>
                           <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">print_caller</span><span class="o">=</span><span class="n">PRINT_CALLER</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;files&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; checks existance before removing. then tries to remove exisint paths &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">print_caller</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">util_dbg</span><span class="o">.</span><span class="n">get_caller_name</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39; called remove_existing_fpaths&#39;</span><span class="p">)</span>
    <span class="n">fpath_list_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">filter_Nones</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span>
    <span class="n">exists_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">exists</span><span class="p">,</span> <span class="n">fpath_list_</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">nTotal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span>
        <span class="n">nValid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list_</span><span class="p">)</span>
        <span class="n">nExist</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">exists_list</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path.remove_existing_fpaths] request delete of </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">nTotal</span><span class="p">,</span> <span class="n">lbl</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nValid</span> <span class="o">!=</span> <span class="n">nTotal</span><span class="p">:</span>
            <span class="k">print</span><span class="p">((</span><span class="s">&#39;[util_path.remove_existing_fpaths] &#39;</span>
                   <span class="s">&#39;trying to delete </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> non None </span><span class="si">%s</span><span class="s"> &#39;</span><span class="p">)</span> <span class="o">%</span>
                  <span class="p">(</span><span class="n">nValid</span><span class="p">,</span> <span class="n">nTotal</span><span class="p">,</span> <span class="n">lbl</span><span class="p">))</span>
        <span class="k">print</span><span class="p">((</span><span class="s">&#39;[util_path.remove_existing_fpaths] &#39;</span>
               <span class="s">&#39; </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s"> exist and need to be deleted&#39;</span><span class="p">)</span>
              <span class="o">%</span> <span class="p">(</span><span class="n">nExist</span><span class="p">,</span> <span class="n">nValid</span><span class="p">))</span>
    <span class="n">existing_fpath_list</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">fpath_list_</span><span class="p">,</span> <span class="n">exists_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">remove_fpaths</span><span class="p">(</span><span class="n">existing_fpath_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span>
                            <span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">,</span> <span class="n">print_caller</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="remove_fpaths"><a class="viewcode-back" href="../../utool.html#utool.util_path.remove_fpaths">[docs]</a><span class="k">def</span> <span class="nf">remove_fpaths</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">QUIET</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                  <span class="n">print_caller</span><span class="o">=</span><span class="n">PRINT_CALLER</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;files&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes multiple file paths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">print_caller</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">util_dbg</span><span class="o">.</span><span class="n">get_caller_name</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39; called remove_fpaths&#39;</span><span class="p">)</span>
    <span class="n">nTotal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span>
    <span class="n">_verbose</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">quiet</span> <span class="ow">and</span> <span class="n">nTotal</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">VERYVERBOSE</span>
    <span class="k">if</span> <span class="n">_verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path.remove_fpaths] try removing </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nTotal</span><span class="p">,</span> <span class="n">lbl</span><span class="p">))</span>
    <span class="n">nRemoved</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_list</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>  <span class="c"># Force refresh</span>
            <span class="n">nRemoved</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">VERYVERBOSE</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: Could not remove fpath = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fpath</span><span class="p">,))</span>
            <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
                <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;Could not remove fpath = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fpath</span><span class="p">,),</span>
                                 <span class="n">iswarning</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">raise</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">_verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path.remove_fpaths] ... removed </span><span class="si">%d</span><span class="s"> / </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">nRemoved</span><span class="p">,</span> <span class="n">nTotal</span><span class="p">,</span> <span class="n">lbl</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">nRemoved</span>

</div>
<span class="n">remove_file_list</span> <span class="o">=</span> <span class="n">remove_fpaths</span>  <span class="c"># backwards compatible</span>


<div class="viewcode-block" id="longest_existing_path"><a class="viewcode-back" href="../../utool.html#utool.util_path.longest_existing_path">[docs]</a><span class="k">def</span> <span class="nf">longest_existing_path</span><span class="p">(</span><span class="n">_path</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Returns the longest root of _path that exists</span>

<span class="sd">    Args:</span>
<span class="sd">        _path (str):  path string</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: _path -  path string</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --exec-longest_existing_path</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; target = dirname(ut.__file__)</span>
<span class="sd">        &gt;&gt;&gt; _path = join(target, &#39;nonexist/foobar&#39;)</span>
<span class="sd">        &gt;&gt;&gt; existing_path = longest_existing_path(_path)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;existing_path = %s&#39; % (str(existing_path),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; assert existing_path == target</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">existing_path</span> <span class="o">=</span> <span class="n">_path</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">_path_new</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">existing_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">_path_new</span><span class="p">):</span>
            <span class="n">existing_path</span> <span class="o">=</span> <span class="n">_path_new</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">_path_new</span> <span class="o">==</span> <span class="n">existing_path</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;!!! [utool] This is a very illformated path indeed.&#39;</span><span class="p">)</span>
            <span class="n">existing_path</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">break</span>
        <span class="n">existing_path</span> <span class="o">=</span> <span class="n">_path_new</span>
    <span class="k">return</span> <span class="n">existing_path</span>

</div>
<div class="viewcode-block" id="get_path_type"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_path_type">[docs]</a><span class="k">def</span> <span class="nf">get_path_type</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    returns if a path is a file, directory, link, or mount</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_type</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
        <span class="n">path_type</span> <span class="o">+=</span> <span class="s">&#39;file&#39;</span>
    <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
        <span class="n">path_type</span> <span class="o">+=</span> <span class="s">&#39;directory&#39;</span>
    <span class="k">if</span> <span class="n">islink</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
        <span class="n">path_type</span> <span class="o">+=</span> <span class="s">&#39;link&#39;</span>
    <span class="k">if</span> <span class="n">ismount</span><span class="p">(</span><span class="n">path_</span><span class="p">):</span>
        <span class="n">path_type</span> <span class="o">+=</span> <span class="s">&#39;mount&#39;</span>
    <span class="k">return</span> <span class="n">path_type</span>

</div>
<div class="viewcode-block" id="checkpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.checkpath">[docs]</a><span class="k">def</span> <span class="nf">checkpath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERYVERBOSE</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">VERYVERBOSE</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot; verbose wrapper around ``os.path.exists``</span>

<span class="sd">    Returns:</span>
<span class="sd">        true if ``path_`` exists on the filesystem show only the</span>
<span class="sd">        top `n` directories</span>

<span class="sd">    Args:</span>
<span class="sd">        path_ (str): path string</span>
<span class="sd">        verbose (bool): verbosity flag(default = False)</span>
<span class="sd">        n (int):  (default = None)</span>
<span class="sd">        info (bool): (default = False)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-checkpath</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; path_ = ut.__file__</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; n = None</span>
<span class="sd">        &gt;&gt;&gt; info = False</span>
<span class="sd">        &gt;&gt;&gt; result = checkpath(path_, verbose, n, info)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        True</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; path_ = ut.__file__ + &#39;foobar&#39;</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; result = checkpath(path_, verbose, n=None, info=True)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">),</span> <span class="p">(</span>
        <span class="s">&#39;path_=</span><span class="si">%r</span><span class="s"> is not a string. type(path_) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">path_</span><span class="p">)))</span>
    <span class="n">path_</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win32&#39;</span><span class="p">):</span>
        <span class="c"># convert back to windows style path if using unix style</span>
        <span class="k">if</span> <span class="n">path_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">dirs</span> <span class="o">=</span> <span class="n">path_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dirs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dirs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span>
                <span class="n">path_</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">does_exist</span> <span class="o">=</span> <span class="n">exists</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="c">#print_(&#39;[utool] checkpath(%r)&#39; % (path_))</span>
        <span class="n">pretty_path</span> <span class="o">=</span> <span class="n">path_ndir_split</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">caller_name</span> <span class="o">=</span> <span class="n">util_dbg</span><span class="o">.</span><span class="n">get_caller_name</span><span class="p">(</span><span class="n">allow_genexpr</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] checkpath(</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">caller_name</span><span class="p">,</span> <span class="n">pretty_path</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">does_exist</span><span class="p">:</span>
            <span class="n">path_type</span> <span class="o">=</span> <span class="n">get_path_type</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span>
            <span class="c">#path_type = &#39;file&#39; if isfile(path_) else &#39;directory&#39;</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] ...(</span><span class="si">%s</span><span class="s">) exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">caller_name</span><span class="p">,</span> <span class="n">path_type</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] ... does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">caller_name</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">does_exist</span> <span class="ow">and</span> <span class="n">info</span><span class="p">:</span>
        <span class="c">#print(&#39;[util_path]  ! Does not exist&#39;)</span>
        <span class="n">_longest_path</span> <span class="o">=</span> <span class="n">longest_existing_path</span><span class="p">(</span><span class="n">path_</span><span class="p">)</span>
        <span class="n">_longest_path_type</span> <span class="o">=</span> <span class="n">get_path_type</span><span class="p">(</span><span class="n">_longest_path</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] ... The longest existing path is: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">_longest_path</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] ... and has type </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_longest_path_type</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">does_exist</span>

</div>
<div class="viewcode-block" id="ensurepath"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensurepath">[docs]</a><span class="k">def</span> <span class="nf">ensurepath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERYVERBOSE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; DEPRICATE - alias - use ensuredir instead &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ensuredir</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ensuredir"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensuredir">[docs]</a><span class="k">def</span> <span class="nf">ensuredir</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERYVERBOSE</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="n">o1777</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Ensures that directory will exist. creates new dir with sticky bits by</span>
<span class="sd">    default</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">checkpath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] mkdir(</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">path_</span><span class="p">)</span>
        <span class="c">#os.makedirs(path_)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">normpath</span><span class="p">(</span><span class="n">path_</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span>
                             <span class="s">&#39;check that the longest existing path &#39;</span>
                             <span class="s">&#39;is not a bad windows symlink.&#39;</span><span class="p">)</span>
            <span class="k">raise</span>
    <span class="k">return</span> <span class="n">path_</span>
    <span class="c">#return True</span>


<span class="c"># ---File Copy---</span>
</div>
<div class="viewcode-block" id="copy_worker"><a class="viewcode-back" href="../../utool.html#utool.util_path.copy_worker">[docs]</a><span class="k">def</span> <span class="nf">copy_worker</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; for util_parallel.generate &quot;&quot;&quot;</span>
    <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">except</span> <span class="n">shutil</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="copy_files_to"><a class="viewcode-back" href="../../utool.html#utool.util_path.copy_files_to">[docs]</a><span class="k">def</span> <span class="nf">copy_files_to</span><span class="p">(</span><span class="n">src_fpath_list</span><span class="p">,</span> <span class="n">dst_dpath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dst_fpath_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">veryverbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    parallel copier</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; overwrite = False</span>
<span class="sd">        &gt;&gt;&gt; veryverbose = False</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; src_fpath_list = [ut.grab_test_imgpath(key)</span>
<span class="sd">        &gt;&gt;&gt;                   for key in ut.get_valid_test_imgkeys()]</span>
<span class="sd">        &gt;&gt;&gt; dst_dpath = ut.get_app_resource_dir(&#39;utool&#39;, &#39;filecopy_tests&#39;)</span>
<span class="sd">        &gt;&gt;&gt; copy_files_to(src_fpath_list, dst_dpath, overwrite=overwrite,</span>
<span class="sd">        &gt;&gt;&gt;               verbose=verbose)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_list</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_parallel</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] +--- COPYING FILES ---&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path]  * len(src_fpath_list) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">src_fpath_list</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path]  * dst_dpath = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dst_dpath</span><span class="p">,))</span>

    <span class="k">if</span> <span class="n">dst_fpath_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ensuredir</span><span class="p">(</span><span class="n">dst_dpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">veryverbose</span><span class="p">)</span>
        <span class="n">dst_fpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">dst_dpath</span><span class="p">,</span> <span class="n">basename</span><span class="p">(</span><span class="n">fpath</span><span class="p">))</span>
                          <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">src_fpath_list</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">dst_dpath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;dst_dpath was specified but overrided&#39;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dst_fpath_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_fpath_list</span><span class="p">),</span> <span class="s">&#39;bad correspondence&#39;</span>

    <span class="n">exists_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">exists</span><span class="p">,</span> <span class="n">dst_fpath_list</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path]  * </span><span class="si">%d</span><span class="s"> files already exist dst_dpath&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="nb">sum</span><span class="p">(</span><span class="n">exists_list</span><span class="p">),))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="n">notexists_list</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">not_list</span><span class="p">(</span><span class="n">exists_list</span><span class="p">)</span>
        <span class="n">dst_fpath_list_</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">dst_fpath_list</span><span class="p">,</span> <span class="n">notexists_list</span><span class="p">)</span>
        <span class="n">src_fpath_list_</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">src_fpath_list</span><span class="p">,</span> <span class="n">notexists_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dst_fpath_list_</span> <span class="o">=</span> <span class="n">dst_fpath_list</span>
        <span class="n">src_fpath_list_</span> <span class="o">=</span> <span class="n">src_fpath_list</span>

    <span class="n">args_list</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_fpath_list_</span><span class="p">,</span> <span class="n">dst_fpath_list_</span><span class="p">)</span>
    <span class="n">_gen</span> <span class="o">=</span> <span class="n">util_parallel</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">copy_worker</span><span class="p">,</span> <span class="n">args_list</span><span class="p">,</span>
                                  <span class="n">nTasks</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">src_fpath_list_</span><span class="p">))</span>
    <span class="n">success_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_gen</span><span class="p">)</span>

    <span class="c">#success_list = copy_list(src_fpath_list_, dst_fpath_list_)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path]  * Copied </span><span class="si">%d</span><span class="s"> / </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">success_list</span><span class="p">),</span>
                                                 <span class="nb">len</span><span class="p">(</span><span class="n">src_fpath_list</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] L___ DONE COPYING FILES ___&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="copy"><a class="viewcode-back" href="../../utool.html#utool.util_path.copy">[docs]</a><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">deeplink</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
            <span class="c"># list to non list</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">copy_files_to</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># list to list</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">copy_files_to</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst_fpath_list</span><span class="o">=</span><span class="n">dst</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
                             <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">copy_single</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">deeplink</span><span class="o">=</span><span class="n">deeplink</span><span class="p">,</span>
                           <span class="n">dryrun</span><span class="o">=</span><span class="n">dryrun</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="copy_single"><a class="viewcode-back" href="../../utool.html#utool.util_path.copy_single">[docs]</a><span class="k">def</span> <span class="nf">copy_single</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">deeplink</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        src (str): file or directory to copy</span>
<span class="sd">        dst (str): directory or new file to copy to</span>

<span class="sd">    Copies src file or folder to dst.</span>

<span class="sd">    If src is a folder this copy is recursive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isdir</span><span class="p">(</span><span class="n">src</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isdir</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
                <span class="c"># copying file to directory</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">basename</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;C+O&#39;</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] [Copying + Overwrite]:&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;Skip&#39;</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] -&gt;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;C&#39;</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dryrun</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] [DryRun]: &#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] [Copying]: &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] | </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">src</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] -&gt;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dryrun</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">deeplink</span> <span class="ow">and</span> <span class="n">islink</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
                    <span class="n">linkto</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
                    <span class="n">symlink</span><span class="p">(</span><span class="n">linkto</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">isdir</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;isdir&#39;</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;Miss&#39;</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] [Cannot Copy]: &#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] src=</span><span class="si">%s</span><span class="s"> does not exist!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">src</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] dst=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_dbg</span>
        <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;Error copying single&#39;</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="s">&#39;dst&#39;</span><span class="p">])</span>
        <span class="k">raise</span>

</div>
<div class="viewcode-block" id="copy_all"><a class="viewcode-back" href="../../utool.html#utool.util_path.copy_all">[docs]</a><span class="k">def</span> <span class="nf">copy_all</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">,</span> <span class="n">glob_str_list</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">ensuredir</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glob_str_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">glob_str_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">glob_str_list</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">src_dir</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">dname_</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">glob_str</span> <span class="ow">in</span> <span class="n">glob_str_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">dname_</span><span class="p">,</span> <span class="n">glob_str</span><span class="p">):</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">dname_</span><span class="p">))</span>
                    <span class="n">dst</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="n">dname_</span><span class="p">))</span>
                    <span class="n">ensuredir</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fname_</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">glob_str</span> <span class="ow">in</span> <span class="n">glob_str_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">fname_</span><span class="p">,</span> <span class="n">glob_str</span><span class="p">):</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">fname_</span><span class="p">))</span>
                    <span class="n">dst</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="n">fname_</span><span class="p">))</span>
                    <span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">break</span>

</div>
<div class="viewcode-block" id="copy_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.copy_list">[docs]</a><span class="k">def</span> <span class="nf">copy_list</span><span class="p">(</span><span class="n">src_list</span><span class="p">,</span> <span class="n">dst_list</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;Copying&#39;</span><span class="p">,</span>
              <span class="n">ioerr_ok</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sherro_ok</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">oserror_ok</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Copies all data and stat info &quot;&quot;&quot;</span>
    <span class="c"># Feb - 6 - 2014 Copy function</span>
    <span class="n">task_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_list</span><span class="p">,</span> <span class="n">dst_list</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">docopy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ioerr_ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">shutil</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sherro_ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ioerr_ok</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="n">progiter</span> <span class="o">=</span> <span class="n">util_progress</span><span class="o">.</span><span class="n">ProgIter</span><span class="p">(</span><span class="n">task_iter</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
    <span class="n">success_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">docopy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="ow">in</span> <span class="n">progiter</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">success_list</span>

</div>
<div class="viewcode-block" id="move"><a class="viewcode-back" href="../../utool.html#utool.util_path.move">[docs]</a><span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;Moving&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">move_list</span><span class="p">([</span><span class="n">src</span><span class="p">],</span> <span class="p">[</span><span class="n">dst</span><span class="p">],</span> <span class="n">lbl</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="move_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.move_list">[docs]</a><span class="k">def</span> <span class="nf">move_list</span><span class="p">(</span><span class="n">src_list</span><span class="p">,</span> <span class="n">dst_list</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="s">&#39;Moving&#39;</span><span class="p">):</span>
    <span class="c"># Feb - 6 - 2014 Move function</span>
    <span class="k">def</span> <span class="nf">trymove</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="n">task_iter</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_list</span><span class="p">,</span> <span class="n">dst_list</span><span class="p">)</span>
    <span class="n">progiter</span> <span class="o">=</span> <span class="n">util_progress</span><span class="o">.</span><span class="n">ProgIter</span><span class="p">(</span><span class="n">task_iter</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">success_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">trymove</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="ow">in</span> <span class="n">progiter</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">success_list</span>

</div>
<div class="viewcode-block" id="win_shortcut"><a class="viewcode-back" href="../../utool.html#utool.util_path.win_shortcut">[docs]</a><span class="k">def</span> <span class="nf">win_shortcut</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">link_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempt to create windows shortcut</span>
<span class="sd">    TODO: TEST / FIXME</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/1447575/symlinks-on-windows</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">True</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ctypes</span>
        <span class="n">kdll</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">LoadLibrary</span><span class="p">(</span><span class="s">&quot;kernel32.dll&quot;</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">kdll</span><span class="o">.</span><span class="n">CreateSymbolicLinkA</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">link_name</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ctypes</span>
        <span class="n">csl</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="o">.</span><span class="n">CreateSymbolicLinkW</span>
        <span class="n">csl</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint32</span><span class="p">)</span>
        <span class="n">csl</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">isdir</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="n">csl</span><span class="p">(</span><span class="n">link_name</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c">#warn_msg = &#39;[util_path] Unable to create symbolic link on windows.&#39;</span>
            <span class="c">#print(warn_msg)</span>
            <span class="c">#warnings.warn(warn_msg, category=UserWarning)</span>
            <span class="k">if</span> <span class="n">checkpath</span><span class="p">(</span><span class="n">link_name</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">raise</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WinError</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="symlink"><a class="viewcode-back" href="../../utool.html#utool.util_path.symlink">[docs]</a><span class="k">def</span> <span class="nf">symlink</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">noraise</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempt to create unix or windows symlink</span>
<span class="sd">    TODO: TEST / FIXME</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str): path to real file or directory</span>
<span class="sd">        link (str): path to desired location for symlink</span>
<span class="sd">        noraise (bool):</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">link</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] symlink </span><span class="si">%r</span><span class="s"> exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">link</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Creating symlink: path=</span><span class="si">%r</span><span class="s"> link_name=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">link</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os_symlink</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&quot;symlink&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">os_symlink</span><span class="p">):</span>
            <span class="n">os_symlink</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">win_shortcut</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">checkpath</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">checkpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;error making symlink&#39;</span><span class="p">,</span> <span class="n">iswarning</span><span class="o">=</span><span class="n">noraise</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">noraise</span><span class="p">:</span>
            <span class="k">raise</span>

</div>
<div class="viewcode-block" id="file_bytes"><a class="viewcode-back" href="../../utool.html#utool.util_path.file_bytes">[docs]</a><span class="k">def</span> <span class="nf">file_bytes</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        fpath (str):  file path string</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: size of file in bytes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>

</div>
<div class="viewcode-block" id="file_megabytes"><a class="viewcode-back" href="../../utool.html#utool.util_path.file_megabytes">[docs]</a><span class="k">def</span> <span class="nf">file_megabytes</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        fpath (str):  file path string</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: size of file in megabytes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="mi">20</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="glob_python_modules"><a class="viewcode-back" href="../../utool.html#utool.util_path.glob_python_modules">[docs]</a><span class="k">def</span> <span class="nf">glob_python_modules</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">glob</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="s">&#39;*.py&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_dirs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="glob"><a class="viewcode-back" href="../../utool.html#utool.util_path.glob">[docs]</a><span class="k">def</span> <span class="nf">glob</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_files</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_dirs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
         <span class="n">maxdepth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude_dirs</span><span class="o">=</span><span class="p">[],</span> <span class="n">fullpath</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Globs directory for pattern</span>

<span class="sd">    Args:</span>
<span class="sd">        dpath (str): directory path or pattern</span>
<span class="sd">        pattern (str or list): pattern or list of patterns</span>
<span class="sd">            (use only if pattern is not in dpath)</span>
<span class="sd">        recursive (bool): (default = False)</span>
<span class="sd">        with_files (bool): (default = True)</span>
<span class="sd">        with_dirs (bool): (default = True)</span>
<span class="sd">        maxdepth (None): (default = None)</span>
<span class="sd">        exclude_dirs (list): (default = [])</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: path_list</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        iglob</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-glob</span>
<span class="sd">        python -m utool.util_path --exec-glob:1</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; from os.path import dirname</span>
<span class="sd">        &gt;&gt;&gt; dpath = dirname(ut.__file__)</span>
<span class="sd">        &gt;&gt;&gt; pattern = &#39;__*.py&#39;</span>
<span class="sd">        &gt;&gt;&gt; recursive = True</span>
<span class="sd">        &gt;&gt;&gt; with_files = True</span>
<span class="sd">        &gt;&gt;&gt; with_dirs = True</span>
<span class="sd">        &gt;&gt;&gt; maxdepth = None</span>
<span class="sd">        &gt;&gt;&gt; fullpath = False</span>
<span class="sd">        &gt;&gt;&gt; exclude_dirs = [&#39;_internal&#39;, join(dpath, &#39;experimental&#39;)]</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;exclude_dirs = &#39; + ut.list_str(exclude_dirs))</span>
<span class="sd">        &gt;&gt;&gt; path_list = glob(dpath, pattern, recursive, with_files, with_dirs,</span>
<span class="sd">        &gt;&gt;&gt;                  maxdepth, exclude_dirs, fullpath)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;path_list = %s&#39; % (ut.list_str(path_list),))</span>
<span class="sd">        &gt;&gt;&gt; result = result.replace(r&#39;\\&#39;, &#39;/&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        path_list = [</span>
<span class="sd">            &#39;__init__.py&#39;,</span>
<span class="sd">            &#39;__main__.py&#39;,</span>
<span class="sd">            &#39;tests/__init__.py&#39;,</span>
<span class="sd">        ]</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; dpath = dirname(ut.__file__) + &#39;/__*.py&#39;</span>
<span class="sd">        &gt;&gt;&gt; path_list = glob(dpath)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;path_list = %s&#39; % (str(path_list),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gen</span> <span class="o">=</span> <span class="n">iglob</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span>
                <span class="n">with_files</span><span class="o">=</span><span class="n">with_files</span><span class="p">,</span> <span class="n">with_dirs</span><span class="o">=</span><span class="n">with_dirs</span><span class="p">,</span> <span class="n">maxdepth</span><span class="o">=</span><span class="n">maxdepth</span><span class="p">,</span>
                <span class="n">fullpath</span><span class="o">=</span><span class="n">fullpath</span><span class="p">,</span> <span class="n">exclude_dirs</span><span class="o">=</span><span class="n">exclude_dirs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">path_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_list</span>

</div>
<div class="viewcode-block" id="iglob"><a class="viewcode-back" href="../../utool.html#utool.util_path.iglob">[docs]</a><span class="k">def</span> <span class="nf">iglob</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_files</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_dirs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
          <span class="n">maxdepth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude_dirs</span><span class="o">=</span><span class="p">[],</span> <span class="n">fullpath</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Iteratively globs directory for pattern</span>

<span class="sd">    FIXME:</span>
<span class="sd">        This function has a speed issue</span>

<span class="sd">    Args:</span>
<span class="sd">        dpath (str):  directory path</span>
<span class="sd">        pattern (str):</span>
<span class="sd">        recursive (bool): (default = False)</span>
<span class="sd">        with_files (bool): (default = True)</span>
<span class="sd">        with_dirs (bool): (default = True)</span>
<span class="sd">        maxdepth (None): (default = None)</span>
<span class="sd">        exclude_dirs (list): (default = [])</span>

<span class="sd">    Yields:</span>
<span class="sd">        path</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/19859840/excluding-dirs-in-os-walk</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_iter</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>  <span class="c"># log what i&#39;m going to do</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] glob(dpath=</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">truepath</span><span class="p">(</span><span class="n">dpath</span><span class="p">,))</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># separate extract pattern from dpath</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[iglob] parsing dpath = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dpath</span><span class="p">,))</span>
        <span class="n">dpath_</span> <span class="o">=</span> <span class="n">dpath</span>
        <span class="n">dpath</span> <span class="o">=</span> <span class="n">longest_existing_path</span><span class="p">(</span><span class="n">dpath_</span><span class="p">)</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">(</span><span class="n">dpath_</span><span class="p">,</span> <span class="n">dpath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># hack check for pattern</span>
        <span class="n">GLOB_PATS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="s">&#39;?&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">GLOB_PATS</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">dpath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span>
                <span class="s">&#39;warning: pattern _=</span><span class="si">%r</span><span class="s"> in dpath, but a pattern was specified&#39;</span> <span class="o">%</span>
                <span class="p">(</span><span class="n">_</span><span class="p">,))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c"># overload pattern with list</span>
        <span class="n">pattern_list</span>  <span class="o">=</span> <span class="n">pattern</span>
        <span class="n">subiters</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">iglob</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span>
                  <span class="n">with_files</span><span class="o">=</span><span class="n">with_files</span><span class="p">,</span> <span class="n">with_dirs</span><span class="o">=</span><span class="n">with_dirs</span><span class="p">,</span>
                  <span class="n">maxdepth</span><span class="o">=</span><span class="n">maxdepth</span><span class="p">,</span> <span class="n">exclude_dirs</span><span class="o">=</span><span class="n">exclude_dirs</span><span class="p">,</span>
                  <span class="n">fullpath</span><span class="o">=</span><span class="n">fullpath</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">pattern_list</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">util_iter</span><span class="o">.</span><span class="n">iflatten</span><span class="p">(</span><span class="n">subiters</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">item</span>
        <span class="k">raise</span> <span class="ne">StopIteration</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[iglob] pattern = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pattern</span><span class="p">,))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[iglob] dpath = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dpath</span><span class="p">,))</span>
    <span class="n">nFiles</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nDirs</span>  <span class="o">=</span> <span class="mi">0</span>
    <span class="n">current_depth</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dpath_</span> <span class="o">=</span> <span class="n">truepath</span><span class="p">(</span><span class="n">dpath</span><span class="p">)</span>
    <span class="n">posx1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dpath_</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
    <span class="c">#exclude_dirs_rel = [relpath(dpath_, dir_) for dir_ in exclude_dirs]</span>
    <span class="c">#exclude_dirs_rel = [relpath(dpath_, dir_) for dir_ in exclude_dirs]</span>
    <span class="c">#print(&#39;\n\n\n&#39;)</span>
    <span class="c">#import utool as ut</span>
    <span class="c">#print(&#39;exclude_dirs = %s&#39; % (ut.list_str(exclude_dirs),))</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dpath_</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c"># Modifying dirs in-place will prune the subsequent files and</span>
        <span class="c"># directories visitied by os.walk</span>
        <span class="c"># References:</span>
        <span class="c">#     http://stackoverflow.com/questions/19859840/excluding-directories-in-os-walk</span>
        <span class="n">rel_root</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dpath_</span><span class="p">)</span>
        <span class="n">rel_root2</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dirname</span><span class="p">(</span><span class="n">dpath_</span><span class="p">))</span>
        <span class="c">#print(&#39;rel_root = %r&#39; % (rel_root,))</span>
        <span class="c">#if len(dirs) &gt; 0:</span>
        <span class="c">#    print(&#39;dirs = %s&#39; % (ut.list_str([join(rel_root, d) for d in dirs]),))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exclude_dirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">rel_root</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_dirs</span><span class="p">]</span>
            <span class="c"># hack</span>
            <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">rel_root2</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_dirs</span><span class="p">]</span>
            <span class="c"># check abs path as well</span>
            <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_dirs</span><span class="p">]</span>

        <span class="c"># yeild data</span>
        <span class="c"># print it only if you want</span>
        <span class="k">if</span> <span class="n">maxdepth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">current_depth</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="n">posx1</span><span class="p">:]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">maxdepth</span> <span class="o">&lt;=</span> <span class="n">current_depth</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="c">#print(&#39;-----------&#39;)</span>
        <span class="c">#print(current_depth)</span>
        <span class="c">#print(root)</span>
        <span class="c">#print(&#39;==&#39;)</span>
        <span class="c">#print(dirs)</span>
        <span class="c">#print(&#39;-----------&#39;)</span>
        <span class="k">if</span> <span class="n">with_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
                <span class="n">nFiles</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fullpath</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">fpath</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">relpath</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">dpath_</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">with_dirs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">dirs</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
                <span class="n">dpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dname</span><span class="p">)</span>
                <span class="n">nDirs</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">fullpath</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">dpath</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">relpath</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">dpath_</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>  <span class="c"># log what i&#39;ve done</span>
        <span class="n">nTotal</span> <span class="o">=</span> <span class="n">nDirs</span> <span class="o">+</span> <span class="n">nFiles</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] iglob Found: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nTotal</span><span class="p">))</span>


<span class="c"># --- Images ----</span>
</div>
<div class="viewcode-block" id="num_images_in_dir"><a class="viewcode-back" href="../../utool.html#utool.util_path.num_images_in_dir">[docs]</a><span class="k">def</span> <span class="nf">num_images_in_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns the number of images in a directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_imgs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">matches_image</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
                <span class="n">num_imgs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">num_imgs</span>

</div>
<div class="viewcode-block" id="matches_image"><a class="viewcode-back" href="../../utool.html#utool.util_path.matches_image">[docs]</a><span class="k">def</span> <span class="nf">matches_image</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns true if a filename matches an image pattern &quot;&quot;&quot;</span>
    <span class="n">fname_</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">img_pats</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*&#39;</span> <span class="o">+</span> <span class="n">ext</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">IMG_EXTENSIONS</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">([</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">fname_</span><span class="p">,</span> <span class="n">pat</span><span class="p">)</span> <span class="k">for</span> <span class="n">pat</span> <span class="ow">in</span> <span class="n">img_pats</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="dirsplit"><a class="viewcode-back" href="../../utool.html#utool.util_path.dirsplit">[docs]</a><span class="k">def</span> <span class="nf">dirsplit</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        path (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: compoments of the path</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --exec-dirsplit</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; paths = []</span>
<span class="sd">        &gt;&gt;&gt; paths.append(&#39;E:/window file/foo&#39;)</span>
<span class="sd">        &gt;&gt;&gt; paths.append(&#39;/normal/foo&#39;)</span>
<span class="sd">        &gt;&gt;&gt; paths.append(&#39;~/relative/path&#39;)</span>
<span class="sd">        &gt;&gt;&gt; results = [dirsplit(path) for path in paths]</span>
<span class="sd">        &gt;&gt;&gt; import re</span>
<span class="sd">        &gt;&gt;&gt; results2 = [re.split(&#39;\\/&#39;, path) for path in paths]</span>
<span class="sd">        &gt;&gt;&gt; print(results2)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr2(results)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#return path.split(os.sep)</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">remain</span> <span class="o">=</span> <span class="n">path</span>
    <span class="n">part</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c">#while True:</span>
    <span class="k">while</span> <span class="n">part</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">remain</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="n">remain</span><span class="p">,</span> <span class="n">part</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">remain</span><span class="p">)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">remain</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remain</span><span class="p">)</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">parts</span>

</div>
<div class="viewcode-block" id="fpaths_to_fnames"><a class="viewcode-back" href="../../utool.html#utool.util_path.fpaths_to_fnames">[docs]</a><span class="k">def</span> <span class="nf">fpaths_to_fnames</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        fpath_list (list of strs): list of file-paths</span>
<span class="sd">    Returns:</span>
<span class="sd">        fname_list (list of strs): list of file-names</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">split</span><span class="p">(</span><span class="n">fpath</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_list</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">fname_list</span>

</div>
<div class="viewcode-block" id="fnames_to_fpaths"><a class="viewcode-back" href="../../utool.html#utool.util_path.fnames_to_fpaths">[docs]</a><span class="k">def</span> <span class="nf">fnames_to_fpaths</span><span class="p">(</span><span class="n">fname_list</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fname_list</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">fpath_list</span>

</div>
<div class="viewcode-block" id="get_modpath_from_modname"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_modpath_from_modname">[docs]</a><span class="k">def</span> <span class="nf">get_modpath_from_modname</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">prefer_pkg</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">prefer_main</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        modname (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: module_dir</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-get_modpath_from_modname</span>

<span class="sd">    Setup:</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; utool_dir = dirname(dirname(ut.__file__))</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; modname = &#39;utool.util_path&#39;</span>
<span class="sd">        &gt;&gt;&gt; module_dir = get_modpath_from_modname(modname)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.truepath_relative(module_dir, utool_dir)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.ensure_unixslash(result)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        utool/util_path.py</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; modname = &#39;utool._internal&#39;</span>
<span class="sd">        &gt;&gt;&gt; module_dir = get_modpath_from_modname(modname, prefer_pkg=True)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.truepath_relative(module_dir, utool_dir)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.ensure_unixslash(result)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        utool/_internal</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; modname = &#39;utool&#39;</span>
<span class="sd">        &gt;&gt;&gt; module_dir = get_modpath_from_modname(modname)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.truepath_relative(module_dir, utool_dir)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.ensure_unixslash(result)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        utool/__init__.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">importlib</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">modname</span>  <span class="c"># Hack</span>
    <span class="n">modpath</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.pyc&#39;</span><span class="p">,</span> <span class="s">&#39;.py&#39;</span><span class="p">)</span>
    <span class="n">initname</span> <span class="o">=</span> <span class="s">&#39;__init__.py&#39;</span>
    <span class="n">mainname</span> <span class="o">=</span> <span class="s">&#39;__main__.py&#39;</span>
    <span class="k">if</span> <span class="n">prefer_pkg</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modpath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">initname</span><span class="p">)</span> <span class="ow">or</span> <span class="n">modpath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">mainname</span><span class="p">):</span>
            <span class="n">modpath</span> <span class="o">=</span> <span class="n">modpath</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">initname</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">prefer_main</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modpath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">initname</span><span class="p">):</span>
            <span class="n">main_modpath</span> <span class="o">=</span> <span class="n">modpath</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">initname</span><span class="p">)]</span> <span class="o">+</span> <span class="n">mainname</span>
            <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">main_modpath</span><span class="p">):</span>
                <span class="n">modpath</span> <span class="o">=</span> <span class="n">main_modpath</span>
    <span class="c">#modname = modname.replace(&#39;.__init__&#39;, &#39;&#39;).strip()</span>
    <span class="c">#module_dir = get_module_dir(module)</span>
    <span class="k">return</span> <span class="n">modpath</span>

</div>
<div class="viewcode-block" id="get_module_dir"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_module_dir">[docs]</a><span class="k">def</span> <span class="nf">get_module_dir</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">module_dir</span> <span class="o">=</span> <span class="n">truepath</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">__file__</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">module_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">module_dir</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module_dir</span>

</div>
<div class="viewcode-block" id="ensure_unixslash"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensure_unixslash">[docs]</a><span class="k">def</span> <span class="nf">ensure_unixslash</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ensure_crossplat_path"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensure_crossplat_path">[docs]</a><span class="k">def</span> <span class="nf">ensure_crossplat_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">winroot</span><span class="o">=</span><span class="s">&#39;C:&#39;</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    ensure_crossplat_path</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: crossplat_path</span>

<span class="sd">    Example(DOCTEST):</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; path = r&#39;C:\somedir&#39;</span>
<span class="sd">        &gt;&gt;&gt; cplat_path = ensure_crossplat_path(path)</span>
<span class="sd">        &gt;&gt;&gt; result = cplat_path</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        C:/somedir</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cplat_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cplat_path</span> <span class="o">==</span> <span class="n">winroot</span><span class="p">:</span>
        <span class="n">cplat_path</span> <span class="o">+=</span> <span class="s">&#39;/&#39;</span>
    <span class="k">return</span> <span class="n">cplat_path</span>

</div>
<div class="viewcode-block" id="ensure_native_path"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensure_native_path">[docs]</a><span class="k">def</span> <span class="nf">ensure_native_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">winroot</span><span class="o">=</span><span class="s">&#39;C:&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">WIN32</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="ow">or</span>  <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">winroot</span> <span class="o">+</span> <span class="n">path</span>

</div>
<div class="viewcode-block" id="get_relative_modpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_relative_modpath">[docs]</a><span class="k">def</span> <span class="nf">get_relative_modpath</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns path to module relative to the package root</span>

<span class="sd">    Args:</span>
<span class="sd">        module_fpath (str): module filepath</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: modname</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; module_fpath = ut.util_path.__file__</span>
<span class="sd">        &gt;&gt;&gt; rel_modpath = ut.get_relative_modpath(module_fpath)</span>
<span class="sd">        &gt;&gt;&gt; rel_modpath = rel_modpath.replace(&#39;.pyc&#39;, &#39;.py&#39;)  # allow pyc or py</span>
<span class="sd">        &gt;&gt;&gt; result = ensure_crossplat_path(rel_modpath)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        utool/util_path.py</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modsubdir_list</span> <span class="o">=</span> <span class="n">get_module_subdir_list</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">)</span>
    <span class="n">rel_modpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">modsubdir_list</span><span class="p">)</span> <span class="o">+</span> <span class="n">ext</span>
    <span class="n">rel_modpath</span> <span class="o">=</span> <span class="n">ensure_crossplat_path</span><span class="p">(</span><span class="n">rel_modpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rel_modpath</span>

</div>
<div class="viewcode-block" id="get_modname_from_modpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_modname_from_modpath">[docs]</a><span class="k">def</span> <span class="nf">get_modname_from_modpath</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns importable name from file path</span>

<span class="sd">    get_modname_from_modpath</span>

<span class="sd">    Args:</span>
<span class="sd">        module_fpath (str): module filepath</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: modname</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; module_fpath = ut.util_path.__file__</span>
<span class="sd">        &gt;&gt;&gt; modname = ut.get_modname_from_modpath(module_fpath)</span>
<span class="sd">        &gt;&gt;&gt; result = modname</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        utool.util_path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modsubdir_list</span> <span class="o">=</span> <span class="n">get_module_subdir_list</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">)</span>
    <span class="n">modname</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">modsubdir_list</span><span class="p">)</span>
    <span class="n">modname</span> <span class="o">=</span> <span class="n">modname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.__init__&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">modname</span> <span class="o">=</span> <span class="n">modname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.__main__&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">modname</span>

</div>
<div class="viewcode-block" id="get_module_subdir_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_module_subdir_list">[docs]</a><span class="k">def</span> <span class="nf">get_module_subdir_list</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get_module_subdir_list</span>

<span class="sd">    Args:</span>
<span class="sd">        module_fpath (str):</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; module_fpath = ut.util_path.__file__</span>
<span class="sd">        &gt;&gt;&gt; modsubdir_list = get_module_subdir_list(module_fpath)</span>
<span class="sd">        &gt;&gt;&gt; result = modsubdir_list</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [&#39;utool&#39;, &#39;util_path&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">module_fpath</span> <span class="o">=</span> <span class="n">truepath</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">)</span>
    <span class="n">dpath</span><span class="p">,</span> <span class="n">fname_ext</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">module_fpath</span><span class="p">)</span>
    <span class="n">fname</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">fname_ext</span><span class="p">)</span>
    <span class="n">full_dpath</span> <span class="o">=</span> <span class="n">dpath</span>
    <span class="n">dpath</span> <span class="o">=</span> <span class="n">full_dpath</span>
    <span class="n">_modsubdir_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">fname</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">is_module_dir</span><span class="p">(</span><span class="n">dpath</span><span class="p">):</span>
        <span class="n">dpath</span><span class="p">,</span> <span class="n">dname</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">dpath</span><span class="p">)</span>
        <span class="n">_modsubdir_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dname</span><span class="p">)</span>
    <span class="n">modsubdir_list</span> <span class="o">=</span> <span class="n">_modsubdir_list</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">modsubdir_list</span>

</div>
<div class="viewcode-block" id="ls"><a class="viewcode-back" href="../../utool.html#utool.util_path.ls">[docs]</a><span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; like unix ls - lists all files and dirs in path&quot;&quot;&quot;</span>
    <span class="n">path_iter</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">path_iter</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="ls_dirs"><a class="viewcode-back" href="../../utool.html#utool.util_path.ls_dirs">[docs]</a><span class="k">def</span> <span class="nf">ls_dirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">):</span>
    <span class="n">dir_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">with_files</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dir_iter</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="ls_modulefiles"><a class="viewcode-back" href="../../utool.html#utool.util_path.ls_modulefiles">[docs]</a><span class="k">def</span> <span class="nf">ls_modulefiles</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">noext</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">module_file_list</span> <span class="o">=</span> <span class="n">ls</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;*.py&#39;</span><span class="p">)</span>
    <span class="n">module_file_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">module_file_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">private</span><span class="p">:</span>
        <span class="n">module_file_iter</span> <span class="o">=</span> <span class="n">filterfalse</span><span class="p">(</span><span class="n">is_private_module</span><span class="p">,</span> <span class="n">module_file_iter</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span>
        <span class="n">module_file_iter</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">module_file_iter</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">noext</span><span class="p">:</span>
        <span class="n">module_file_iter</span> <span class="o">=</span> <span class="p">(</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">module_file_iter</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">module_file_iter</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ls_moduledirs"><a class="viewcode-back" href="../../utool.html#utool.util_path.ls_moduledirs">[docs]</a><span class="k">def</span> <span class="nf">ls_moduledirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; lists all dirs which are python modules in path &quot;&quot;&quot;</span>
    <span class="n">dir_list</span> <span class="o">=</span> <span class="n">ls_dirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">module_dir_iter</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">is_module_dir</span><span class="p">,</span> <span class="n">dir_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">private</span><span class="p">:</span>
        <span class="n">module_dir_iter</span> <span class="o">=</span> <span class="n">filterfalse</span><span class="p">(</span><span class="n">is_private_module</span><span class="p">,</span> <span class="n">module_dir_iter</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span>
        <span class="n">module_dir_iter</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">module_dir_iter</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">module_dir_iter</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_basename_noext_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_basename_noext_list">[docs]</a><span class="k">def</span> <span class="nf">get_basename_noext_list</span><span class="p">(</span><span class="n">path_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">basename_noext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="get_ext_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_ext_list">[docs]</a><span class="k">def</span> <span class="nf">get_ext_list</span><span class="p">(</span><span class="n">path_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="get_basepath_list"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_basepath_list">[docs]</a><span class="k">def</span> <span class="nf">get_basepath_list</span><span class="p">(</span><span class="n">path_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="basename_noext"><a class="viewcode-back" href="../../utool.html#utool.util_path.basename_noext">[docs]</a><span class="k">def</span> <span class="nf">basename_noext</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="append_suffixlist_to_namelist"><a class="viewcode-back" href="../../utool.html#utool.util_path.append_suffixlist_to_namelist">[docs]</a><span class="k">def</span> <span class="nf">append_suffixlist_to_namelist</span><span class="p">(</span><span class="n">name_list</span><span class="p">,</span> <span class="n">suffix_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; adds a suffix to the path before the extension</span>
<span class="sd">    if name_list is a path_list the basepath is stripped away &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix_list</span><span class="p">)</span>
    <span class="c">#basepath_list  = utool.get_basepath_list(name_list)</span>
    <span class="n">gnamenoext_list</span> <span class="o">=</span> <span class="n">get_basename_noext_list</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
    <span class="n">ext_list</span>        <span class="o">=</span> <span class="n">get_ext_list</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
    <span class="n">new_name_list</span>   <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="n">ext</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">ext</span> <span class="ow">in</span>
                        <span class="nb">zip</span><span class="p">(</span><span class="n">gnamenoext_list</span><span class="p">,</span> <span class="n">suffix_list</span><span class="p">,</span> <span class="n">ext_list</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">new_name_list</span>

</div>
<div class="viewcode-block" id="is_private_module"><a class="viewcode-back" href="../../utool.html#utool.util_path.is_private_module">[docs]</a><span class="k">def</span> <span class="nf">is_private_module</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;__&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="is_python_module"><a class="viewcode-back" href="../../utool.html#utool.util_path.is_python_module">[docs]</a><span class="k">def</span> <span class="nf">is_python_module</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.py&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.pyc&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="is_module_dir"><a class="viewcode-back" href="../../utool.html#utool.util_path.is_module_dir">[docs]</a><span class="k">def</span> <span class="nf">is_module_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        path (str)</span>

<span class="sd">    Returns:</span>
<span class="sd">        flag: True if path contains an __init__ file</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; path = truepath(&#39;~/code/utool/utool&#39;)</span>
<span class="sd">        &gt;&gt;&gt; flag = is_module_dir(path)</span>
<span class="sd">        &gt;&gt;&gt; result = (flag)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">exists</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;__init__.py&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="list_images"><a class="viewcode-back" href="../../utool.html#utool.util_path.list_images">[docs]</a><span class="k">def</span> <span class="nf">list_images</span><span class="p">(</span><span class="n">img_dpath_</span><span class="p">,</span> <span class="n">ignore_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fullpath</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">full</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of images in a directory. By default returns relative paths.</span>

<span class="sd">    TODO: rename to ls_images</span>
<span class="sd">    TODO: Change all instances of fullpath to full</span>

<span class="sd">    Args:</span>
<span class="sd">        img_dpath_ (str):</span>
<span class="sd">        ignore_list (list): (default = [])</span>
<span class="sd">        recursive (bool): (default = False)</span>
<span class="sd">        fullpath (bool): (default = False)</span>
<span class="sd">        full (None): (default = None)</span>
<span class="sd">        sort (bool): (default = True)</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: gname_list</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --exec-list_images</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; img_dpath_ = &#39;?&#39;</span>
<span class="sd">        &gt;&gt;&gt; ignore_list = []</span>
<span class="sd">        &gt;&gt;&gt; recursive = False</span>
<span class="sd">        &gt;&gt;&gt; fullpath = False</span>
<span class="sd">        &gt;&gt;&gt; full = None</span>
<span class="sd">        &gt;&gt;&gt; sort = True</span>
<span class="sd">        &gt;&gt;&gt; gname_list = list_images(img_dpath_, ignore_list, recursive,</span>
<span class="sd">        &gt;&gt;&gt;                          fullpath, full, sort)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;gname_list = %s&#39; % (str(gname_list),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#if not QUIET:</span>
    <span class="c">#    print(ignore_list)</span>
    <span class="k">if</span> <span class="n">full</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">fullpath</span> <span class="ow">or</span> <span class="n">full</span>
    <span class="n">img_dpath</span> <span class="o">=</span> <span class="n">realpath</span><span class="p">(</span><span class="n">img_dpath_</span><span class="p">)</span>
    <span class="n">ignore_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ignore_list</span><span class="p">)</span>
    <span class="n">gname_list_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">assertpath</span><span class="p">(</span><span class="n">img_dpath</span><span class="p">)</span>
    <span class="c"># Get all the files in a directory recursively</span>
    <span class="n">true_imgpath</span> <span class="o">=</span> <span class="n">truepath</span><span class="p">(</span><span class="n">img_dpath</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dlist</span><span class="p">,</span> <span class="n">flist</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">true_imgpath</span><span class="p">):</span>
        <span class="n">rel_dpath</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">img_dpath</span><span class="p">)</span>
        <span class="c"># Ignore directories</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">dname</span> <span class="ow">in</span> <span class="n">ignore_set</span> <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="n">dirsplit</span><span class="p">(</span><span class="n">rel_dpath</span><span class="p">)]):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">flist</span><span class="p">):</span>
            <span class="n">gname</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">rel_dpath</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">):</span>
                <span class="n">gname</span> <span class="o">=</span> <span class="n">gname</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">matches_image</span><span class="p">(</span><span class="n">gname</span><span class="p">):</span>
                <span class="c"># Ignore Files</span>
                <span class="k">if</span> <span class="n">gname</span> <span class="ow">in</span> <span class="n">ignore_set</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">fullpath</span><span class="p">:</span>
                    <span class="n">gpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">img_dpath</span><span class="p">,</span> <span class="n">gname</span><span class="p">)</span>
                    <span class="n">gname_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gpath</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gname_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="c"># Filter out non images or ignorables</span>
    <span class="c">#gname_list = [gname_ for gname_ in iter(gname_list_)</span>
    <span class="c">#              if gname_ not in ignore_set and matches_image(gname_)]</span>
    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="n">gname_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">gname_list_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gname_list</span>

</div>
<span class="n">ls_images</span> <span class="o">=</span> <span class="n">list_images</span>


<div class="viewcode-block" id="assertpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.assertpath">[docs]</a><span class="k">def</span> <span class="nf">assertpath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Asserts that a patha exists &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">NO_ASSERTS</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">path_</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;path is None! </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">path_</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;path=</span><span class="si">%r</span><span class="s"> is the empty string! </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">checkpath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;path=</span><span class="si">%r</span><span class="s"> does not exist! </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

</div>
<span class="n">assert_exists</span> <span class="o">=</span> <span class="n">assertpath</span>
<span class="c">#def assert_exists(path, msg=&#39;&#39;, **kwargs):</span>
<span class="c">#    if NO_ASSERTS:</span>
<span class="c">#        return</span>
<span class="c">#    return assertpath(path, msg, **kwargs)</span>
<span class="c">#    #assert exists(path), &#39;path=%r does not exist! %s&#39; % (path, msg)</span>


<div class="viewcode-block" id="pathsplit_full"><a class="viewcode-back" href="../../utool.html#utool.util_path.pathsplit_full">[docs]</a><span class="k">def</span> <span class="nf">pathsplit_full</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; splits all directories in path into a list &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_standard_exclude_dnames"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_standard_exclude_dnames">[docs]</a><span class="k">def</span> <span class="nf">get_standard_exclude_dnames</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="s">&#39;lib.linux-x86_64-2.7&#39;</span><span class="p">,</span> <span class="s">&#39;dist&#39;</span><span class="p">,</span> <span class="s">&#39;build&#39;</span><span class="p">,</span> <span class="s">&#39;_page&#39;</span><span class="p">,</span> <span class="s">&#39;_doc&#39;</span><span class="p">,</span>
            <span class="s">&#39;utool.egg-info&#39;</span><span class="p">,</span> <span class="s">&#39;.git&#39;</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="get_standard_include_patterns"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_standard_include_patterns">[docs]</a><span class="k">def</span> <span class="nf">get_standard_include_patterns</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="s">&#39;*.py&#39;</span><span class="p">,</span> <span class="s">&#39;*.cxx&#39;</span><span class="p">,</span> <span class="s">&#39;*.cpp&#39;</span><span class="p">,</span> <span class="s">&#39;*.hxx&#39;</span><span class="p">,</span> <span class="s">&#39;*.hpp&#39;</span><span class="p">,</span> <span class="s">&#39;*.c&#39;</span><span class="p">,</span> <span class="s">&#39;*.h&#39;</span><span class="p">,</span> <span class="s">&#39;*.vim&#39;</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="matching_fnames"><a class="viewcode-back" href="../../utool.html#utool.util_path.matching_fnames">[docs]</a><span class="k">def</span> <span class="nf">matching_fnames</span><span class="p">(</span><span class="n">dpath_list</span><span class="p">,</span> <span class="n">include_patterns</span><span class="p">,</span> <span class="n">exclude_dirs</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">greater_exclude_dirs</span><span class="o">=</span><span class="p">[],</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    matching_fnames. walks dpath lists returning all directories that match the</span>
<span class="sd">    requested pattern.</span>

<span class="sd">    Args:</span>
<span class="sd">        dpath_list       (list):</span>
<span class="sd">        include_patterns (str):</span>
<span class="sd">        exclude_dirs     (None):</span>
<span class="sd">        recursive        (bool):</span>

<span class="sd">    References:</span>
<span class="sd">        # TODO: fix names and behavior of exclude_dirs and greater_exclude_dirs</span>
<span class="sd">        http://stackoverflow.com/questions/19859840/excluding-directories-in-os-walk</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; dpath_list = [dirname(dirname(ut.__file__))]</span>
<span class="sd">        &gt;&gt;&gt; include_patterns = get_standard_include_patterns()</span>
<span class="sd">        &gt;&gt;&gt; exclude_dirs = [&#39;_page&#39;]</span>
<span class="sd">        &gt;&gt;&gt; greater_exclude_dirs = get_standard_exclude_dnames()</span>
<span class="sd">        &gt;&gt;&gt; recursive = True</span>
<span class="sd">        &gt;&gt;&gt; fpath_gen = matching_fnames(dpath_list, include_patterns, exclude_dirs,</span>
<span class="sd">        &gt;&gt;&gt;                             greater_exclude_dirs, recursive)</span>
<span class="sd">        &gt;&gt;&gt; result = list(fpath_gen)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;\n&#39;.join(result))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dpath_list</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">dpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dpath_list</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">dpath</span> <span class="ow">in</span> <span class="n">dpath_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dname_list</span><span class="p">,</span> <span class="n">fname_list</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dpath</span><span class="p">):</span>
            <span class="c"># Look at all subdirs</span>
            <span class="n">subdirs</span> <span class="o">=</span> <span class="n">pathsplit_full</span><span class="p">(</span><span class="n">relpath</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dpath</span><span class="p">))</span>
            <span class="c"># HACK:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">dir_</span> <span class="ow">in</span> <span class="n">greater_exclude_dirs</span> <span class="k">for</span> <span class="n">dir_</span> <span class="ow">in</span> <span class="n">subdirs</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="c"># Look at one subdir</span>
            <span class="k">if</span> <span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="ow">in</span> <span class="n">exclude_dirs</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fname_list</span><span class="p">:</span>
                <span class="c"># For the filesnames which match the patterns</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pat</span><span class="p">)</span> <span class="k">for</span> <span class="n">pat</span> <span class="ow">in</span> <span class="n">include_patterns</span><span class="p">]):</span>
                    <span class="k">yield</span> <span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="c">#fname_list.append((root, name))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="c">#return fname_list</span>

</div>
<div class="viewcode-block" id="sed"><a class="viewcode-back" href="../../utool.html#utool.util_path.sed">[docs]</a><span class="k">def</span> <span class="nf">sed</span><span class="p">(</span><span class="n">regexpr</span><span class="p">,</span> <span class="n">repl</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">dpath_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">fpath_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Python implementation of sed. NOT FINISHED</span>

<span class="sd">    searches and replaces text in files</span>

<span class="sd">    Args:</span>
<span class="sd">        regexpr (str): regx patterns to find</span>
<span class="sd">        repl (str): text to replace</span>
<span class="sd">        force (bool):</span>
<span class="sd">        recursive (bool):</span>
<span class="sd">        dpath_list (list): directories to search (defaults to cwd)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#_grep(r, [repl], dpath_list=dpath_list, recursive=recursive)</span>
    <span class="n">include_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*.py&#39;</span><span class="p">,</span> <span class="s">&#39;*.cxx&#39;</span><span class="p">,</span> <span class="s">&#39;*.cpp&#39;</span><span class="p">,</span> <span class="s">&#39;*.hxx&#39;</span><span class="p">,</span> <span class="s">&#39;*.hpp&#39;</span><span class="p">,</span> <span class="s">&#39;*.c&#39;</span><span class="p">,</span> <span class="s">&#39;*.h&#39;</span><span class="p">,</span> <span class="s">&#39;*.html&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dpath_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">dpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()]</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">NOT_QUIET</span>
    <span class="k">if</span> <span class="n">fpath_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">greater_exclude_dirs</span> <span class="o">=</span> <span class="n">get_standard_exclude_dnames</span><span class="p">()</span>
        <span class="n">exclude_dirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fpath_generator</span> <span class="o">=</span> <span class="n">matching_fnames</span><span class="p">(</span>
            <span class="n">dpath_list</span><span class="p">,</span> <span class="n">include_patterns</span><span class="p">,</span> <span class="n">exclude_dirs</span><span class="p">,</span> <span class="n">greater_exclude_dirs</span><span class="p">,</span>
            <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
        <span class="c">#fpath_generator = matching_fnames(dpath_list, include_patterns, recursive=recursive)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fpath_generator</span> <span class="o">=</span> <span class="n">fpath_list</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;sed-ing </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dpath_list</span><span class="p">,))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39; * regular expression : </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">regexpr</span><span class="p">,))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39; * replacement        : </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">repl</span><span class="p">,))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39; * recursive: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">recursive</span><span class="p">,))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39; * force: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">force</span><span class="p">,))</span>
        <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_str</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39; * fpath_list: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">util_str</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">),))</span>
    <span class="n">regexpr</span> <span class="o">=</span> <span class="n">extend_regex</span><span class="p">(</span><span class="n">regexpr</span><span class="p">)</span>
    <span class="c">#if &#39;\x08&#39; in regexpr:</span>
    <span class="c">#    print(&#39;Remember \\x08 != \\b&#39;)</span>
    <span class="c">#    print(&#39;subsituting for you for you&#39;)</span>
    <span class="c">#    regexpr = regexpr.replace(&#39;\x08&#39;, &#39;\\b&#39;)</span>
    <span class="c">#    print(&#39; * regular expression : %r&#39; % (regexpr,))</span>

    <span class="c"># Walk through each directory recursively</span>
    <span class="n">num_changed</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fpaths_changed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_generator</span><span class="p">:</span>
        <span class="n">changed_lines</span> <span class="o">=</span> <span class="n">sedfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">regexpr</span><span class="p">,</span> <span class="n">repl</span><span class="p">,</span> <span class="n">force</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">changed_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fpaths_changed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="n">num_changed</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">changed_lines</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;fpaths_changed = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">repr3</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">fpaths_changed</span><span class="p">)),))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;total lines changed = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_changed</span><span class="p">,))</span>

</div>
<div class="viewcode-block" id="sedfile"><a class="viewcode-back" href="../../utool.html#utool.util_path.sedfile">[docs]</a><span class="k">def</span> <span class="nf">sedfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">regexpr</span><span class="p">,</span> <span class="n">repl</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">veryverbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes sed on a specific file</span>

<span class="sd">    Args:</span>
<span class="sd">        fpath (str):  file path string</span>
<span class="sd">        regexpr (str):</span>
<span class="sd">        repl (str):</span>
<span class="sd">        force (bool): (default = False)</span>
<span class="sd">        verbose (bool):  verbosity flag(default = True)</span>
<span class="sd">        veryverbose (bool): (default = False)</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: changed_lines</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --exec-sedfile --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; fpath = ut.get_modpath_from_modname(ut.util_path)</span>
<span class="sd">        &gt;&gt;&gt; regexpr = &#39;sedfile&#39;</span>
<span class="sd">        &gt;&gt;&gt; repl = &#39;saidfile&#39;</span>
<span class="sd">        &gt;&gt;&gt; force = False</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; veryverbose = False</span>
<span class="sd">        &gt;&gt;&gt; changed_lines = sedfile(fpath, regexpr, repl, force, verbose, veryverbose)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;changed_lines = %s&#39; % (ut.repr3(changed_lines),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># TODO: move to util_edit</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="n">new_file_lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">veryverbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[sedfile] fpath=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[sedfile] regexpr=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">regexpr</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[sedfile] repl=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">repl</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[sedfile] force=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">force</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">file_lines</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="c"># Search each line for the desired regexpr</span>
        <span class="n">new_file_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">regexpr</span><span class="p">,</span> <span class="n">repl</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file_lines</span><span class="p">]</span>

    <span class="n">changed_lines</span> <span class="o">=</span> <span class="p">[(</span><span class="n">newline</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">newline</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_file_lines</span><span class="p">,</span> <span class="n">file_lines</span><span class="p">)</span>
                     <span class="k">if</span>  <span class="n">newline</span> <span class="o">!=</span> <span class="n">line</span><span class="p">]</span>
    <span class="n">nChanged</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">changed_lines</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nChanged</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">rel_fpath</span> <span class="o">=</span> <span class="n">relpath</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39; * </span><span class="si">%s</span><span class="s"> changed </span><span class="si">%d</span><span class="s"> lines in </span><span class="si">%r</span><span class="s"> &#39;</span> <span class="o">%</span>
              <span class="p">([</span><span class="s">&#39;(dry-run)&#39;</span><span class="p">,</span> <span class="s">&#39;(real-run)&#39;</span><span class="p">][</span><span class="n">force</span><span class="p">],</span> <span class="n">nChanged</span><span class="p">,</span> <span class="n">rel_fpath</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39; * --------------------&#39;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
        <span class="n">new_file_lines</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">lmap</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ensure_unicode</span><span class="p">,</span> <span class="n">new_file_lines</span><span class="p">)</span>
        <span class="n">new_file</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_file_lines</span><span class="p">)</span>
        <span class="c">#print(new_file.replace(&#39;\n&#39;,&#39;\n))</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">True</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
                <span class="n">old_file</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_unicode</span><span class="p">(</span>
                    <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">lmap</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ensure_unicode</span><span class="p">,</span> <span class="n">file_lines</span><span class="p">)))</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">print_difftext</span><span class="p">(</span><span class="n">old_file</span><span class="p">,</span> <span class="n">new_file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">changed_new</span><span class="p">,</span> <span class="n">changed_old</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">changed_lines</span><span class="p">)</span>
                <span class="n">prefixold</span> <span class="o">=</span> <span class="s">&#39; * old (</span><span class="si">%d</span><span class="s">, </span><span class="si">%r</span><span class="s">):  </span><span class="se">\n</span><span class="s"> | &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nChanged</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">prefixnew</span> <span class="o">=</span> <span class="s">&#39; * new (</span><span class="si">%d</span><span class="s">, </span><span class="si">%r</span><span class="s">):  </span><span class="se">\n</span><span class="s"> | &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nChanged</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">prefixold</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">changed_old</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39; * ____________________&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">prefixnew</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">changed_new</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39; * --------------------&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39; * =====================================================&#39;</span><span class="p">)</span>
        <span class="c"># Write back to file</span>
        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39; ! WRITING CHANGES&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_file</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39; dry run&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">changed_lines</span>
    <span class="c">#elif verbose:</span>
    <span class="c">#    print(&#39;Nothing changed&#39;)</span>
    <span class="k">return</span> <span class="bp">None</span>

</div>
<span class="nd">@profile</span>
<div class="viewcode-block" id="grepfile"><a class="viewcode-back" href="../../utool.html#utool.util_path.grepfile">[docs]</a><span class="k">def</span> <span class="nf">grepfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">regexpr_list</span><span class="p">,</span> <span class="n">reflags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    grepfile - greps a specific file</span>

<span class="sd">    Args:</span>
<span class="sd">        fpath (str):</span>
<span class="sd">        regexpr_list (list or str): pattern or list of patterns</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple (list, list): list of lines and list of line numbers</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --exec-grepfile</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; fpath = ut.get_modpath_from_modname(ut.util_path)</span>
<span class="sd">        &gt;&gt;&gt; regexpr_list = [&#39;foundthisline&#39;, &#39;__future__&#39;]</span>
<span class="sd">        &gt;&gt;&gt; cache = None</span>
<span class="sd">        &gt;&gt;&gt; reflags = 0</span>
<span class="sd">        &gt;&gt;&gt; found_lines, found_lxs = ut.grepfile(fpath, regexpr_list)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.repr3({&#39;found_lines&#39;: found_lines, &#39;found_lxs&#39;: found_lxs})</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; assert 7 in found_lxs</span>
<span class="sd">        &gt;&gt;&gt; others = ut.take_complement(found_lxs, [found_lxs.index(7)])</span>
<span class="sd">        &gt;&gt;&gt; assert others[0] == others[1]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">found_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">found_lxs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># Ensure a list</span>
    <span class="n">islist</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regexpr_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
    <span class="n">islist2</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reflags</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
    <span class="n">regexpr_list_</span> <span class="o">=</span> <span class="n">regexpr_list</span> <span class="k">if</span> <span class="n">islist</span> <span class="k">else</span> <span class="p">[</span><span class="n">regexpr_list</span><span class="p">]</span>
    <span class="n">reflags_list</span> <span class="o">=</span> <span class="n">reflags</span> <span class="k">if</span> <span class="n">islist2</span> <span class="k">else</span> <span class="p">[</span><span class="n">reflags</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">regexpr_list_</span><span class="p">)</span>
    <span class="n">re_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">_flags</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">pat</span><span class="p">,</span> <span class="n">_flags</span> <span class="ow">in</span>  <span class="nb">zip</span><span class="p">(</span><span class="n">regexpr_list_</span><span class="p">,</span> <span class="n">reflags_list</span><span class="p">)]</span>
    <span class="c">#print(&#39;regexpr_list_ = %r&#39; % (regexpr_list_,))</span>
    <span class="c">#print(&#39;re_list = %r&#39; % (re_list,))</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="c"># Open file and search lines or use cache</span>
    <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">fpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
        <span class="c">#with open(fpath, &#39;r&#39;) as file_:</span>
        <span class="c">#    lines = list(file_.readlines())</span>
        <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_io</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">util_io</span><span class="o">.</span><span class="n">read_from</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">aslines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#import utool as ut</span>
        <span class="c">#cumsum = ut.cumsum(map(len, lines))</span>
        <span class="n">cumsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">lines</span><span class="p">)))</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">fpath</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cumsum</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="p">(</span><span class="n">cumsum</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="n">fpath</span><span class="p">]</span>

    <span class="c"># Search each line for each pattern</span>
    <span class="n">old_method</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">old_method</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="c">#for regexpr_ in regexpr_list_:</span>
            <span class="n">match_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">re_</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">re_</span> <span class="ow">in</span> <span class="n">re_list</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">match_objects</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">found_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">found_lxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">re_</span> <span class="ow">in</span> <span class="n">re_list</span><span class="p">:</span>
            <span class="c"># FIXME: multiline mode doesnt work</span>
            <span class="k">for</span> <span class="n">match_object</span> <span class="ow">in</span> <span class="n">re_</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="c">#print(&#39;match_object = %r&#39; % (match_object,))</span>
                <span class="n">lxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">match_object</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">cumsum</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lxs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lx</span> <span class="o">=</span> <span class="n">lxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">lx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">line_start</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">[</span><span class="n">lx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">line_start</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">line_end</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">[</span><span class="n">lx</span><span class="p">]</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">line_start</span><span class="p">:</span><span class="n">line_end</span><span class="p">]</span>
                    <span class="n">found_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">found_lxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lx</span><span class="p">)</span>
                <span class="c">#[match_object.start &gt; x for x in cumsum]</span>
    <span class="k">return</span> <span class="n">found_lines</span><span class="p">,</span> <span class="n">found_lxs</span>

</div>
<div class="viewcode-block" id="testgrep"><a class="viewcode-back" href="../../utool.html#utool.util_path.testgrep">[docs]</a><span class="k">def</span> <span class="nf">testgrep</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    utprof.py -m utool.util_path --exec-testgrep</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; #dpath_list = [ut.truepath(&#39;~/code/utool/utool&#39;)]</span>
<span class="sd">        &gt;&gt;&gt; dpath_list = [ut.truepath(dirname(ut.__file__))]</span>
<span class="sd">        &gt;&gt;&gt; include_patterns = [&#39;*.py&#39;]</span>
<span class="sd">        &gt;&gt;&gt; exclude_dirs = []</span>
<span class="sd">        &gt;&gt;&gt; regex_list = [&#39;grepfile&#39;]</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; recursive = True</span>
<span class="sd">        &gt;&gt;&gt; result = ut.grep(regex_list, recursive, dpath_list, include_patterns,</span>
<span class="sd">        &gt;&gt;&gt;                  exclude_dirs)</span>
<span class="sd">        &gt;&gt;&gt; (found_fpath_list, found_lines_list, found_lxs_list) = result</span>
<span class="sd">        &gt;&gt;&gt; assert &#39;util_path.py&#39; in list(map(basename, found_fpath_list))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="c"># FIXME: util_test can&#39;t find the function if profile is enabled</span></div>
<span class="nd">@profile</span>
<div class="viewcode-block" id="grep"><a class="viewcode-back" href="../../utool.html#utool.util_path.grep">[docs]</a><span class="k">def</span> <span class="nf">grep</span><span class="p">(</span><span class="n">regex_list</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dpath_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">include_patterns</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
         <span class="n">exclude_dirs</span><span class="o">=</span><span class="p">[],</span> <span class="n">greater_exclude_dirs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
         <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">fpath_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">reflags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    greps for patterns</span>
<span class="sd">    Python implementation of grep. NOT FINISHED</span>

<span class="sd">    Args:</span>
<span class="sd">        regex_list (str or list): one or more patterns to find</span>
<span class="sd">        recursive (bool):</span>
<span class="sd">        dpath_list (list): directories to search (defaults to cwd)</span>
<span class="sd">        include_patterns (list) : defaults to standard file extensions</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list, list, list): (found_fpaths, found_lines_list, found_lxs_list)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-grep</span>
<span class="sd">        utprof.py -m utool.util_path --exec-grep</span>
<span class="sd">        utprof.py utool/util_path.py --exec-grep</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; #dpath_list = [ut.truepath(&#39;~/code/utool/utool&#39;)]</span>
<span class="sd">        &gt;&gt;&gt; dpath_list = [ut.truepath(dirname(ut.__file__))]</span>
<span class="sd">        &gt;&gt;&gt; include_patterns = [&#39;*.py&#39;]</span>
<span class="sd">        &gt;&gt;&gt; exclude_dirs = []</span>
<span class="sd">        &gt;&gt;&gt; regex_list = [&#39;grepfile&#39;]</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; recursive = True</span>
<span class="sd">        &gt;&gt;&gt; result = ut.grep(regex_list, recursive, dpath_list, include_patterns,</span>
<span class="sd">        &gt;&gt;&gt;                  exclude_dirs)</span>
<span class="sd">        &gt;&gt;&gt; (found_fpath_list, found_lines_list, found_lxs_list) = result</span>
<span class="sd">        &gt;&gt;&gt; assert &#39;util_path.py&#39; in list(map(basename, found_fpath_list))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_regex</span>
    <span class="c"># from utool import util_str</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_list</span>
    <span class="k">if</span> <span class="n">include_patterns</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">include_patterns</span> <span class="o">=</span>  <span class="n">get_standard_include_patterns</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">greater_exclude_dirs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">greater_exclude_dirs</span> <span class="o">=</span>  <span class="n">get_standard_exclude_dnames</span><span class="p">()</span>
    <span class="c"># ensure list input</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include_patterns</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">include_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">include_patterns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dpath_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">dpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()]</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">recursive_stat_str</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;flat&#39;</span><span class="p">,</span> <span class="s">&#39;recursive&#39;</span><span class="p">][</span><span class="n">recursive</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Greping (</span><span class="si">%s</span><span class="s">) </span><span class="si">%r</span><span class="s"> for </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">recursive_stat_str</span><span class="p">,</span>
                                                      <span class="n">dpath_list</span><span class="p">,</span> <span class="n">regex_list</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] regex_list = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">regex_list</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regex_list</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
        <span class="n">regex_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">regex_list</span><span class="p">]</span>
    <span class="n">found_fpath_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">found_lines_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">found_lxs_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># Walk through each directory recursively</span>
    <span class="k">if</span> <span class="n">fpath_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fpath_generator</span> <span class="o">=</span> <span class="n">matching_fnames</span><span class="p">(</span><span class="n">dpath_list</span><span class="p">,</span> <span class="n">include_patterns</span><span class="p">,</span>
                                          <span class="n">exclude_dirs</span><span class="p">,</span> <span class="n">greater_exclude_dirs</span><span class="p">,</span>
                                          <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fpath_generator</span> <span class="o">=</span> <span class="n">fpath_list</span>
    <span class="c">#     from utool import util_regex</span>
    <span class="c">#     extended_regex_list, reflags = util_regex.extend_regex3(regex_list, reflags)</span>
    <span class="c">#     if verbose:</span>
    <span class="c">#         print(&#39;extended_regex_list = %r&#39; % (extended_regex_list,))</span>
    <span class="c">#         print(&#39;reflags = %r&#39; % (reflags,))</span>
    <span class="n">_exprs_flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">util_regex</span><span class="o">.</span><span class="n">extend_regex2</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">reflags</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">regex_list</span><span class="p">]</span>
    <span class="n">extended_regex_list</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">_exprs_flags</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">reflags_list</span> <span class="o">=</span> <span class="n">util_list</span><span class="o">.</span><span class="n">take_column</span><span class="p">(</span><span class="n">_exprs_flags</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c"># HACK</span>
    <span class="n">reflags</span> <span class="o">=</span> <span class="n">reflags_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c"># For each matching filepath</span>
    <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_generator</span><span class="p">:</span>
        <span class="c"># For each search pattern</span>
        <span class="n">found_lines</span><span class="p">,</span> <span class="n">found_lxs</span> <span class="o">=</span> <span class="n">grepfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">extended_regex_list</span><span class="p">,</span>
                                          <span class="n">reflags_list</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inverse</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># Append files that the pattern was not found in</span>
                <span class="n">found_fpath_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
                <span class="n">found_lines_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="n">found_lxs_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">found_fpath_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>  <span class="c"># regular matching</span>
            <span class="n">found_lines_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">found_lines</span><span class="p">)</span>
            <span class="n">found_lxs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">found_lxs</span><span class="p">)</span>

    <span class="n">grep_result</span> <span class="o">=</span> <span class="p">(</span><span class="n">found_fpath_list</span><span class="p">,</span> <span class="n">found_lines_list</span><span class="p">,</span> <span class="n">found_lxs_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;==========&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;==========&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] found matches in </span><span class="si">%d</span><span class="s"> files&#39;</span> <span class="o">%</span>
              <span class="nb">len</span><span class="p">(</span><span class="n">found_fpath_list</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">make_grep_resultstr</span><span class="p">(</span><span class="n">grep_result</span><span class="p">,</span> <span class="n">extended_regex_list</span><span class="p">,</span> <span class="n">reflags</span><span class="p">))</span>
        <span class="c"># print(&#39;[util_path] found matches in %d files&#39; % len(found_fpath_list))</span>

        <span class="c"># pat = util_regex.regex_or(extended_regex_list)</span>

        <span class="c"># for fpath, found, lxs in zip(found_fpath_list, found_lines_list,</span>
        <span class="c">#                              found_lxs_list):</span>
        <span class="c">#     if len(found) &gt; 0:</span>
        <span class="c">#         print(&#39;----------------------&#39;)</span>
        <span class="c">#         print(&#39;Found %d line(s) in %r: &#39; % (len(found), fpath))</span>
        <span class="c">#         name = split(fpath)[1]</span>
        <span class="c">#         max_line = len(lxs)</span>
        <span class="c">#         ndigits = str(len(str(max_line)))</span>
        <span class="c">#         fmt_str = &#39;%s : %&#39; + ndigits + &#39;d |%s&#39;</span>
        <span class="c">#         for (lx, line) in zip(lxs, found):</span>
        <span class="c">#             # hack</span>
        <span class="c">#             colored_line = util_str.highlight_regex(</span>
        <span class="c">#                 line.rstrip(&#39;\n&#39;), pat, reflags=reflags)</span>
        <span class="c">#             print(fmt_str % (name, lx, colored_line))</span>

        <span class="c">#print(&#39;[util_path] found matches in %d files&#39; % len(found_fpath_list))</span>

    <span class="k">return</span> <span class="n">grep_result</span>

</div>
<div class="viewcode-block" id="make_grep_resultstr"><a class="viewcode-back" href="../../utool.html#utool.util_path.make_grep_resultstr">[docs]</a><span class="k">def</span> <span class="nf">make_grep_resultstr</span><span class="p">(</span><span class="n">grep_result</span><span class="p">,</span> <span class="n">extended_regex_list</span><span class="p">,</span> <span class="n">reflags</span><span class="p">,</span> <span class="n">colored</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_regex</span>
    <span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_str</span>
    <span class="n">msg_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">print_</span> <span class="o">=</span> <span class="n">msg_list</span><span class="o">.</span><span class="n">append</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="n">util_regex</span><span class="o">.</span><span class="n">regex_or</span><span class="p">(</span><span class="n">extended_regex_list</span><span class="p">)</span>
    <span class="n">found_fpath_list</span><span class="p">,</span> <span class="n">found_lines_list</span><span class="p">,</span> <span class="n">found_lxs_list</span> <span class="o">=</span> <span class="n">grep_result</span>
    <span class="k">for</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">lxs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">found_fpath_list</span><span class="p">,</span> <span class="n">found_lines_list</span><span class="p">,</span>
                                 <span class="n">found_lxs_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">print_</span><span class="p">(</span><span class="s">&#39;----------------------&#39;</span><span class="p">)</span>
            <span class="n">print_</span><span class="p">(</span><span class="s">&#39;Found </span><span class="si">%d</span><span class="s"> line(s) in </span><span class="si">%r</span><span class="s">: &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">),</span> <span class="n">fpath</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">fpath</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">max_line</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lxs</span><span class="p">)</span>
            <span class="n">ndigits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">max_line</span><span class="p">)))</span>
            <span class="n">fmt_str</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> : %&#39;</span> <span class="o">+</span> <span class="n">ndigits</span> <span class="o">+</span> <span class="s">&#39;d |</span><span class="si">%s</span><span class="s">&#39;</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lxs</span><span class="p">,</span> <span class="n">found</span><span class="p">):</span>
                <span class="c"># hack</span>
                <span class="n">colored_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">colored</span><span class="p">:</span>
                    <span class="n">colored_line</span> <span class="o">=</span> <span class="n">util_str</span><span class="o">.</span><span class="n">highlight_regex</span><span class="p">(</span><span class="n">colored_line</span><span class="p">,</span> <span class="n">pat</span><span class="p">,</span> <span class="n">reflags</span><span class="o">=</span><span class="n">reflags</span><span class="p">)</span>
                <span class="n">print_</span><span class="p">(</span><span class="n">fmt_str</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">colored_line</span><span class="p">))</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg_list</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_win32_short_path_name"><a class="viewcode-back" href="../../utool.html#utool.util_path.get_win32_short_path_name">[docs]</a><span class="k">def</span> <span class="nf">get_win32_short_path_name</span><span class="p">(</span><span class="n">long_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the short path name of a given long path.</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/a/23598461/200291</span>
<span class="sd">        http://stackoverflow.com/questions/23598289/get-win-short-fname-python</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; #long_name = unicode(normpath(ut.get_resource_dir()))</span>
<span class="sd">        &gt;&gt;&gt; long_name = unicode(r&#39;C:/Program Files (x86)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #long_name = unicode(r&#39;C:/Python27&#39;)</span>
<span class="sd">        #unicode(normpath(ut.get_resource_dir()))</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; result = get_win32_short_path_name(long_name)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        C:/PROGRA~2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">ctypes</span>
    <span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="n">wintypes</span>
    <span class="n">_GetShortPathNameW</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="o">.</span><span class="n">GetShortPathNameW</span>
    <span class="n">_GetShortPathNameW</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">wintypes</span><span class="o">.</span><span class="n">LPCWSTR</span><span class="p">,</span> <span class="n">wintypes</span><span class="o">.</span><span class="n">LPWSTR</span><span class="p">,</span> <span class="n">wintypes</span><span class="o">.</span><span class="n">DWORD</span><span class="p">]</span>
    <span class="n">_GetShortPathNameW</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">wintypes</span><span class="o">.</span><span class="n">DWORD</span>
    <span class="n">output_buf_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">output_buf</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_unicode_buffer</span><span class="p">(</span><span class="n">output_buf_size</span><span class="p">)</span>
        <span class="n">needed</span> <span class="o">=</span> <span class="n">_GetShortPathNameW</span><span class="p">(</span><span class="n">long_name</span><span class="p">,</span> <span class="n">output_buf</span><span class="p">,</span> <span class="n">output_buf_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_buf_size</span> <span class="o">&gt;=</span> <span class="n">needed</span><span class="p">:</span>
            <span class="n">short_name</span> <span class="o">=</span> <span class="n">output_buf</span><span class="o">.</span><span class="n">value</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_buf_size</span> <span class="o">=</span> <span class="n">needed</span>
    <span class="k">return</span> <span class="n">short_name</span>

</div>
<div class="viewcode-block" id="expand_win32_shortname"><a class="viewcode-back" href="../../utool.html#utool.util_path.expand_win32_shortname">[docs]</a><span class="k">def</span> <span class="nf">expand_win32_shortname</span><span class="p">(</span><span class="n">path1</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c">#try:</span>
        <span class="c">#    import win32file</span>
        <span class="c">#    path2 = win32file.GetLongPathName(path1)</span>
        <span class="c">#except ImportError:</span>
            <span class="kn">import</span> <span class="nn">ctypes</span>
            <span class="c">#import win32file</span>
            <span class="n">path1</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span>
            <span class="n">buflen</span> <span class="o">=</span> <span class="mi">260</span>  <span class="c"># max size</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_unicode_buffer</span><span class="p">(</span><span class="n">buflen</span><span class="p">)</span>
            <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="o">.</span><span class="n">GetLongPathNameW</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">buflen</span><span class="p">)</span>
            <span class="c"># If the path doesnt exist windows doesnt return anything</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">path1</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;cannot fix win32 shortcut&#39;</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;path1&#39;</span><span class="p">,</span> <span class="s">&#39;path2&#39;</span><span class="p">])</span>
        <span class="n">path2</span> <span class="o">=</span> <span class="n">path1</span>
        <span class="c">#raise</span>
    <span class="k">return</span> <span class="n">path2</span>

</div>
<div class="viewcode-block" id="platform_path"><a class="viewcode-back" href="../../utool.html#utool.util_path.platform_path">[docs]</a><span class="k">def</span> <span class="nf">platform_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Returns platform specific path for pyinstaller usage</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: path2</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-platform_path</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; # FIXME: find examples of the wird paths this fixes (mostly on win32 i think)</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; path = &#39;some/odd/../weird/path&#39;</span>
<span class="sd">        &gt;&gt;&gt; path2 = platform_path(path)</span>
<span class="sd">        &gt;&gt;&gt; result = str(path2)</span>
<span class="sd">        &gt;&gt;&gt; if ut.WIN32:</span>
<span class="sd">        ...     ut.assert_eq(path2, r&#39;some\weird\path&#39;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     ut.assert_eq(path2, r&#39;some/weird/path&#39;)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut    # NOQA</span>
<span class="sd">        &gt;&gt;&gt; if ut.WIN32:</span>
<span class="sd">        ...     path = &#39;C:/PROGRA~2&#39;</span>
<span class="sd">        ...     path2 = platform_path(path)</span>
<span class="sd">        ...     assert path2 == u&#39;..\\..\\..\\..\\Program Files (x86)&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;path cannot be the empty string&#39;</span><span class="p">)</span>
        <span class="c"># get path relative to cwd</span>
        <span class="n">path1</span> <span class="o">=</span> <span class="n">truepath_relative</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win32&#39;</span><span class="p">):</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">expand_win32_shortname</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path2</span> <span class="o">=</span> <span class="n">path1</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">,</span> <span class="s">&#39;path1&#39;</span><span class="p">,</span> <span class="s">&#39;path2&#39;</span><span class="p">])</span>
        <span class="k">raise</span>
    <span class="k">return</span> <span class="n">path2</span>

</div>
<div class="viewcode-block" id="existing_subpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.existing_subpath">[docs]</a><span class="k">def</span> <span class="nf">existing_subpath</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">valid_subpaths</span><span class="p">,</span> <span class="n">tiebreaker</span><span class="o">=</span><span class="s">&#39;first&#39;</span><span class="p">,</span>
                     <span class="n">verbose</span><span class="o">=</span><span class="n">VERYVERBOSE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns join(root_path, subpath) where subpath in valid_subpath ane</span>
<span class="sd">    exists(subpath)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Find the oxford_style groundtruth directory</span>
    <span class="k">for</span> <span class="n">subpath</span> <span class="ow">in</span> <span class="n">valid_subpaths</span><span class="p">:</span>
        <span class="n">path</span>  <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">checkpath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tiebreaker</span> <span class="o">==</span> <span class="s">&#39;first&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">path</span>
    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;none of the following subpaths exist: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">valid_subpaths</span><span class="p">,))</span>

</div>
<div class="viewcode-block" id="existing_commonprefix"><a class="viewcode-back" href="../../utool.html#utool.util_path.existing_commonprefix">[docs]</a><span class="k">def</span> <span class="nf">existing_commonprefix</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">longest_existing_path</span><span class="p">(</span><span class="n">commonprefix</span><span class="p">(</span><span class="n">paths</span><span class="p">))</span>


<span class="c">#def find_executable(exename):</span>
<span class="c">#    import utool as ut</span>
<span class="c">#    search_dpaths = ut.get_install_dirs()</span>
<span class="c">#    pass</span>

</div>
<div class="viewcode-block" id="search_in_dirs"><a class="viewcode-back" href="../../utool.html#utool.util_path.search_in_dirs">[docs]</a><span class="k">def</span> <span class="nf">search_in_dirs</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">search_dpaths</span><span class="o">=</span><span class="p">[],</span> <span class="n">shortcircuit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                   <span class="n">return_tried</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    search_in_dirs</span>

<span class="sd">    Args:</span>
<span class="sd">        fname (str):  file name</span>
<span class="sd">        search_dpaths (list):</span>
<span class="sd">        shortcircuit (bool):</span>
<span class="sd">        return_tried (bool): return tried paths</span>
<span class="sd">        strict (bool): (default = False)</span>

<span class="sd">    Returns:</span>
<span class="sd">        fpath: None</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; fname = &#39;Inno Setup 5\ISCC.exe&#39;</span>
<span class="sd">        &gt;&gt;&gt; search_dpaths = ut.get_install_dirs()</span>
<span class="sd">        &gt;&gt;&gt; shortcircuit = True</span>
<span class="sd">        &gt;&gt;&gt; fpath = ut.search_in_dirs(fname, search_dpaths, shortcircuit)</span>
<span class="sd">        &gt;&gt;&gt; print(fpath)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tried_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dpath</span> <span class="ow">in</span> <span class="n">search_dpaths</span><span class="p">:</span>
        <span class="n">fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_tried</span><span class="p">:</span>
            <span class="n">tried_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">shortcircuit</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">return_tried</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">tried_list</span>
                <span class="k">return</span> <span class="n">fpath</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fpath_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">strict</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Cannot find: fname=</span><span class="si">%r</span><span class="se">\n</span><span class="s">&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">return_tried</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;Tried: </span><span class="se">\n</span><span class="s">    &#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tried_list</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">shortcircuit</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_tried</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="n">tried_list</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_tried</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fpath_list</span><span class="p">,</span> <span class="n">tried_list</span>
        <span class="k">return</span> <span class="n">fpath_list</span>

</div>
<div class="viewcode-block" id="find_lib_fpath"><a class="viewcode-back" href="../../utool.html#utool.util_path.find_lib_fpath">[docs]</a><span class="k">def</span> <span class="nf">find_lib_fpath</span><span class="p">(</span><span class="n">libname</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">,</span> <span class="n">recurse_down</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Search for the library &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_lib_fname_list</span><span class="p">(</span><span class="n">libname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        input &lt;libname&gt;: library name (e.g. &#39;hesaff&#39;, not &#39;libhesaff&#39;)</span>
<span class="sd">        returns &lt;libnames&gt;: list of plausible library file names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win32&#39;</span><span class="p">):</span>
            <span class="n">libnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;lib&#39;</span> <span class="o">+</span> <span class="n">libname</span> <span class="o">+</span> <span class="s">&#39;.dll&#39;</span><span class="p">,</span> <span class="n">libname</span> <span class="o">+</span> <span class="s">&#39;.dll&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;darwin&#39;</span><span class="p">):</span>
            <span class="n">libnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;lib&#39;</span> <span class="o">+</span> <span class="n">libname</span> <span class="o">+</span> <span class="s">&#39;.dylib&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;linux&#39;</span><span class="p">):</span>
            <span class="n">libnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;lib&#39;</span> <span class="o">+</span> <span class="n">libname</span> <span class="o">+</span> <span class="s">&#39;.so&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unknown operating system: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">libnames</span>

    <span class="k">def</span> <span class="nf">get_lib_dpath_list</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        input &lt;root_dir&gt;: deepest directory to look for a library (dll, so, dylib)</span>
<span class="sd">        returns &lt;libnames&gt;: list of plausible directories to look.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="s">&#39;returns possible lib locations&#39;</span>
        <span class="n">get_lib_dpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">root_dir</span><span class="p">,</span>
                              <span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">),</span>
                              <span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="s">&#39;build&#39;</span><span class="p">),</span>
                              <span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="s">&#39;build&#39;</span><span class="p">,</span> <span class="s">&#39;lib&#39;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">get_lib_dpath_list</span>

    <span class="n">lib_fname_list</span> <span class="o">=</span> <span class="n">get_lib_fname_list</span><span class="p">(</span><span class="n">libname</span><span class="p">)</span>
    <span class="n">tried_fpaths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">root_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lib_fname</span> <span class="ow">in</span> <span class="n">lib_fname_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lib_dpath</span> <span class="ow">in</span> <span class="n">get_lib_dpath_list</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>
                <span class="n">lib_fpath</span> <span class="o">=</span> <span class="n">normpath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">lib_dpath</span><span class="p">,</span> <span class="n">lib_fname</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">lib_fpath</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">[c] Checked: &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tried_fpaths</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;using: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">lib_fpath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">lib_fpath</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Remember which candiate library fpaths did not exist</span>
                    <span class="n">tried_fpaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lib_fpath</span><span class="p">)</span>
            <span class="n">_new_root</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="n">root_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_new_root</span> <span class="o">==</span> <span class="n">root_dir</span><span class="p">:</span>
                <span class="n">root_dir</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">root_dir</span> <span class="o">=</span> <span class="n">_new_root</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recurse_down</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">[C!] load_clib(libname=</span><span class="si">%r</span><span class="s"> root_dir=</span><span class="si">%r</span><span class="s">, recurse_down=</span><span class="si">%r</span><span class="s">, verbose=</span><span class="si">%r</span><span class="s">)&#39;</span> <span class="o">%</span>
           <span class="p">(</span><span class="n">libname</span><span class="p">,</span> <span class="n">root_dir</span><span class="p">,</span> <span class="n">recurse_down</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span> <span class="o">+</span>
           <span class="s">&#39;</span><span class="se">\n</span><span class="s">[c!] Cannot FIND dynamic library&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">[c!] Checked: &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tried_fpaths</span><span class="p">))</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ensure_mingw_drive"><a class="viewcode-back" href="../../utool.html#utool.util_path.ensure_mingw_drive">[docs]</a><span class="k">def</span> <span class="nf">ensure_mingw_drive</span><span class="p">(</span><span class="n">win32_path</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot; replaces windows drives with mingw style drives</span>

<span class="sd">    Args:</span>
<span class="sd">        win32_path (str):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-ensure_mingw_drive</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; win32_path = r&#39;C:/Program Files/Foobar&#39;</span>
<span class="sd">        &gt;&gt;&gt; result = ensure_mingw_drive(win32_path)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        /c/Program Files/Foobar</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">win32_drive</span><span class="p">,</span> <span class="n">_path</span> <span class="o">=</span> <span class="n">splitdrive</span><span class="p">(</span><span class="n">win32_path</span><span class="p">)</span>
    <span class="n">mingw_drive</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">win32_drive</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">mingw_path</span> <span class="o">=</span> <span class="n">mingw_drive</span> <span class="o">+</span> <span class="n">_path</span>
    <span class="k">return</span> <span class="n">mingw_path</span>

</div>
<div class="viewcode-block" id="ChdirContext"><a class="viewcode-back" href="../../utool.html#utool.util_path.ChdirContext">[docs]</a><span class="k">class</span> <span class="nc">ChdirContext</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References http://www.astropython.org/snippet/2009/10/chdir-context-manager</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dpath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stay</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stay</span> <span class="o">=</span> <span class="n">stay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpath</span> <span class="o">=</span> <span class="n">dpath</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[path.push] Change directory to </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpath</span><span class="p">,))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stay</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;[path.pop] Change directory to </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curdir</span><span class="p">,))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[util_path] Error in chdir context manager!: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">False</span>  <span class="c"># return a falsey value on error</span>

</div>
<div class="viewcode-block" id="search_candidate_paths"><a class="viewcode-back" href="../../utool.html#utool.util_path.search_candidate_paths">[docs]</a><span class="k">def</span> <span class="nf">search_candidate_paths</span><span class="p">(</span><span class="n">candidate_path_list</span><span class="p">,</span> <span class="n">candidate_name_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">priority_paths</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">required_subpaths</span><span class="o">=</span><span class="p">[],</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="ow">not</span> <span class="n">QUIET</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    searches for existing paths that meed a requirement</span>

<span class="sd">    Args:</span>
<span class="sd">        candidate_path_list (list): list of paths to check. If</span>
<span class="sd">            candidate_name_list is specified this is the dpath list instead</span>
<span class="sd">        candidate_name_list (list): specifies several names to check</span>
<span class="sd">            (default = None)</span>
<span class="sd">        priority_paths (None): specifies paths to check first.</span>
<span class="sd">            Ignore candidate_name_list (default = None)</span>
<span class="sd">        required_subpaths (list): specified required directory structure</span>
<span class="sd">            (default = [])</span>
<span class="sd">        verbose (bool):  verbosity flag(default = True)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: return_path</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_path --test-search_candidate_paths</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_path import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; candidate_path_list = [ut.truepath(&#39;~/RPI/code/utool&#39;),</span>
<span class="sd">        &gt;&gt;&gt;                        ut.truepath(&#39;~/code/utool&#39;)]</span>
<span class="sd">        &gt;&gt;&gt; candidate_name_list = None</span>
<span class="sd">        &gt;&gt;&gt; required_subpaths = []</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; priority_paths = None</span>
<span class="sd">        &gt;&gt;&gt; return_path = search_candidate_paths(candidate_path_list,</span>
<span class="sd">        &gt;&gt;&gt;                                      candidate_name_list,</span>
<span class="sd">        &gt;&gt;&gt;                                      priority_paths, required_subpaths,</span>
<span class="sd">        &gt;&gt;&gt;                                      verbose)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;return_path = %s&#39; % (str(return_path),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[search_candidate_paths] Searching for candidate paths&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="n">candidate_name_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">candidate_path_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span> <span class="k">for</span> <span class="n">dpath</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span>
                                <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">candidate_path_list</span><span class="p">,</span>
                                                  <span class="n">candidate_name_list</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">candidate_path_list_</span> <span class="o">=</span> <span class="n">candidate_path_list</span>

    <span class="k">if</span> <span class="n">priority_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">candidate_path_list_</span> <span class="o">=</span> <span class="n">priority_paths</span> <span class="o">+</span> <span class="n">candidate_path_list_</span>

    <span class="n">return_path</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">candidate_path_list_</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[search_candidate_paths] Found candidate directory </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;[search_candidate_paths] ... checking for approprate structure&#39;</span><span class="p">)</span>
            <span class="c"># tomcat directory exists. Make sure it also contains a webapps dir</span>
            <span class="n">subpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">subpath</span><span class="p">)</span> <span class="k">for</span> <span class="n">subpath</span> <span class="ow">in</span> <span class="n">required_subpaths</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span> <span class="k">for</span> <span class="n">path_</span> <span class="ow">in</span> <span class="n">subpath_list</span><span class="p">):</span>
                <span class="n">return_path</span> <span class="o">=</span> <span class="n">path</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[search_candidate_paths] Found acceptable path&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">return_path</span>
                <span class="k">break</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;[search_candidate_paths] Failed to find acceptable path&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">return_path</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -c &quot;import utool, utool.util_path; utool.doctest_funcs(utool.util_path)&quot;</span>
<span class="sd">        python -m utool.util_path</span>
<span class="sd">        python -m utool.util_path --allexamples</span>
<span class="sd">        python -m utool.util_path --allexamples --noface --nosrc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>  <span class="c"># NOQA</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Jon Crall.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.1.2.dev1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>